{"version":3,"file":"main.js","mappings":"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","sources":["webpack:///./src/CurvyWallsToolBar.ts","webpack:///./src/CurvyWallToolManager.ts","webpack:///./src/tools/BezierTool.ts","webpack:///../common/Settings.ts","webpack:///./src/tools/CircleTool.ts","webpack:///./src/tools/ToolInputHandler.ts","webpack:///./src/tools/RectangleTool.ts","webpack:///./src/tools/CubicTool.ts","webpack:///./libs/bezier.js","webpack:///./src/tools/QuadTool.ts","webpack:///./src/tools/PointMapper.ts","webpack:///webpack/bootstrap","webpack:///webpack/runtime/define property getters","webpack:///webpack/runtime/hasOwnProperty shorthand","webpack:///webpack/runtime/make namespace object","webpack:///./src/df-curvy-walls.ts"],"sourcesContent":["\nimport { CurvyWallToolManager, Mode } from './CurvyWallToolManager';\nimport SETTINGS from \"../../common/Settings\";\nimport { ToolMode } from './tools/BezierTool';\n\nexport interface CurvyWallControl {\n\ttitle: string;\n\ticon: string;\n\ttoggleable?: boolean;\n\tclass?: string;\n\tisActive?: () => boolean;\n\tonClick: (enabled?: boolean) => void;\n}\ninterface CurvyWallControlUI {\n\tname: string;\n\ttitle: string;\n\ticon: string;\n\ttoggleable?: boolean;\n\tclass?: string;\n\tisActive?: boolean;\n}\ninterface CurvyWallsToolsOptions {\n\ttools: CurvyWallControlUI[];\n\tgeneral: CurvyWallControlUI[];\n\tcontrols: CurvyWallControlUI[];\n}\n\nexport class CurvyWallsToolBar extends Application {\n\tstatic readonly PREF_PRESERVE = 'preserve-tool';\n\n\tstatic get defaultOptions(): Application.Options {\n\t\treturn mergeObject(super.defaultOptions, {\n\t\t\tpopOut: false,\n\t\t\ttemplate: 'modules/df-curvy-walls/templates/curvy-walls-controls.hbs'\n\t\t});\n\t}\n\n\tprivate _closing = false;\n\n\tprivate _tools: Record<string, CurvyWallControl> = {\n\t\tbeziercube: {\n\t\t\ttitle: \"df-curvy-walls.cubic\",\n\t\t\ticon: \"fas fa-bezier-curve\",\n\t\t\tisActive: function () { return CurvyWallToolManager.instance.mode == Mode.Cube; },\n\t\t\tonClick: function () { return CurvyWallToolManager.instance.mode = this.isActive() ? Mode.None : Mode.Cube; }\n\t\t},\n\t\tbezierquad: {\n\t\t\ttitle: \"df-curvy-walls.quadratic\",\n\t\t\ticon: \"fas fa-project-diagram\",\n\t\t\tisActive: function () { return CurvyWallToolManager.instance.mode == Mode.Quad; },\n\t\t\tonClick: function () { return CurvyWallToolManager.instance.mode = this.isActive() ? Mode.None : Mode.Quad; }\n\t\t},\n\t\tbeziercirc: {\n\t\t\ttitle: \"df-curvy-walls.circle\",\n\t\t\ticon: \"fas fa-circle\",\n\t\t\tisActive: function () { return CurvyWallToolManager.instance.mode == Mode.Circ; },\n\t\t\tonClick: function () { return CurvyWallToolManager.instance.mode = this.isActive() ? Mode.None : Mode.Circ; }\n\t\t},\n\t\tbezierrect: {\n\t\t\ttitle: \"df-curvy-walls.rectangle\",\n\t\t\ticon: \"fas fa-vector-square\",\n\t\t\tisActive: function () { return CurvyWallToolManager.instance.mode == Mode.Rect; },\n\t\t\tonClick: function () { return CurvyWallToolManager.instance.mode = this.isActive() ? Mode.None : Mode.Rect; }\n\t\t}\n\t};\n\tprivate _generalControls: Record<string, CurvyWallControl> = {\n\t\tincrement: {\n\t\t\ttitle: 'df-curvy-walls.increment',\n\t\t\ticon: 'fas fa-plus',\n\t\t\tonClick: () => CurvyWallToolManager.instance.segments++\n\t\t},\n\t\tdecrement: {\n\t\t\ttitle: 'df-curvy-walls.decrement',\n\t\t\ticon: 'fas fa-minus',\n\t\t\tonClick: () => CurvyWallToolManager.instance.segments--\n\t\t},\n\t\tapply: {\n\t\t\ttitle: 'df-curvy-walls.apply',\n\t\t\ticon: 'fas fa-check',\n\t\t\tclass: 'apply',\n\t\t\tonClick: CurvyWallToolManager.instance.apply.bind(CurvyWallToolManager.instance)\n\t\t},\n\t\tcancel: {\n\t\t\ttitle: 'df-curvy-walls.cancel',\n\t\t\ticon: 'fas fa-times',\n\t\t\tclass: 'cancel',\n\t\t\tonClick: CurvyWallToolManager.instance.clearTool.bind(CurvyWallToolManager.instance)\n\t\t}\n\t};\n\tprivate _placementControls: Record<string, CurvyWallControl> = {\n\t\tpointconstruct: {\n\t\t\ttitle: 'df-curvy-walls.trace_curve_with_points',\n\t\t\ticon: 'fas fa-route',\n\t\t\ttoggleable: true,\n\t\t\tisActive: () => CurvyWallToolManager.instance.currentlyMappingPoints,\n\t\t\tonClick: () => {\n\t\t\t\tCurvyWallToolManager.instance.togglePointMapping();\n\t\t\t\tthis.render(false);\n\t\t\t}\n\t\t},\n\t\tapplyplacement: {\n\t\t\ttitle: 'df-curvy-walls.pointmapapply',\n\t\t\ticon: 'fas fa-check',\n\t\t\tclass: 'apply',\n\t\t\tonClick: () => { CurvyWallToolManager.instance.applyPointMapping(); }\n\t\t}\n\t};\n\n\tconstructor(options?: Application.Options) {\n\t\tsuper(options);\n\t\tCurvyWallToolManager.instance.setModeListener(() => {\n\t\t\tif (this._closing) {\n\t\t\t\tthis._closing = false;\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.render(false);\n\t\t});\n\t}\n\n\tgetData(): CurvyWallsToolsOptions {\n\t\tconst toolIsPlaced = CurvyWallToolManager.instance.mode != Mode.None && CurvyWallToolManager.instance.activeTool.mode != ToolMode.NotPlaced;\n\t\tconst toolControls = CurvyWallToolManager.instance.activeTool?.getTools();\n\t\tconst placementControls: CurvyWallControlUI[] = [{\n\t\t\tname: 'pointconstruct',\n\t\t\ttitle: this._placementControls.pointconstruct.title,\n\t\t\ticon: this._placementControls.pointconstruct.icon,\n\t\t\tclass: this._placementControls.pointconstruct.class,\n\t\t\ttoggleable: true,\n\t\t\tisActive: this._placementControls.pointconstruct.isActive()\n\t\t}];\n\t\tif (CurvyWallToolManager.instance.currentlyMappingPoints && CurvyWallToolManager.instance.canApplyPointMapping)\n\t\t\tplacementControls.push({\n\t\t\t\tname: 'applyplacement',\n\t\t\t\ttitle: this._placementControls.applyplacement.title,\n\t\t\t\ticon: this._placementControls.applyplacement.icon,\n\t\t\t\tclass: this._placementControls.applyplacement.class\n\t\t\t});\n\n\t\tconst data: CurvyWallsToolsOptions = {\n\t\t\ttools: Object.keys(this._tools).map(it => {\n\t\t\t\treturn {\n\t\t\t\t\tname: it,\n\t\t\t\t\ttitle: this._tools[it].title,\n\t\t\t\t\ticon: this._tools[it].icon,\n\t\t\t\t\ttoggleable: true,\n\t\t\t\t\tisActive: this._tools[it].isActive()\n\t\t\t\t};\n\t\t\t}),\n\t\t\tgeneral: toolIsPlaced ? Object.keys(this._generalControls).map(it => {\n\t\t\t\treturn {\n\t\t\t\t\tname: it,\n\t\t\t\t\ttitle: this._generalControls[it].title,\n\t\t\t\t\ticon: this._generalControls[it].icon,\n\t\t\t\t\tclass: this._generalControls[it].class\n\t\t\t\t};\n\t\t\t}) : [Mode.Quad, Mode.Circ, Mode.Rect].includes(CurvyWallToolManager.instance.mode) ? placementControls : [],\n\t\t\tcontrols: toolIsPlaced && !!toolControls ? Object.keys(toolControls).map(it => {\n\t\t\t\treturn {\n\t\t\t\t\tname: it,\n\t\t\t\t\ttitle: toolControls[it].title,\n\t\t\t\t\ticon: toolControls[it].icon,\n\t\t\t\t\tclass: toolControls[it].class,\n\t\t\t\t\ttoggleable: toolControls[it].toggleable,\n\t\t\t\t\tisActive: toolControls[it].toggleable ? toolControls[it].isActive() : undefined\n\t\t\t\t};\n\t\t\t}) : []\n\t\t};\n\n\t\treturn data;\n\t}\n\n\tactivateListeners(html: JQuery<HTMLElement>) {\n\t\tif ((<any>window).buttonOverflow !== undefined) {\n\t\t\tconst align = () => {\n\t\t\t\tconst layersHeight = $(\"ol#controls\").height();\n\t\t\t\tconst controlsHeight = $('ol#controls>li[data-control=\"walls\"]>ol').height();\n\t\t\t\tconst layerCount = document.querySelector(\"ol#controls\").childElementCount;\n\t\t\t\tconst controlCount = document.querySelector('ol#controls>li[data-control=\"walls\"]>ol').childElementCount;\n\t\t\t\tconst layers = Math.ceil(((layerCount - ((<any>window).buttonOverflow.hiddenButtons || 0)) / layersHeight) * 46) * 46 + 10;\n\t\t\t\tconst controls = Math.ceil((controlCount / controlsHeight) * 46) * 46;\n\t\t\t\t// document.body.style.setProperty(\"--playerlist-offset\", `${layers}px`);\n\t\t\t\thtml.css('left', `${layers + controls}px`);\n\t\t\t};\n\t\t\twindow.addEventListener(\"resize\", align);\n\t\t\talign();\n\t\t}\n\t\thtml.find('li').on(\"click\", (event: JQuery.ClickEvent) => {\n\t\t\tconst element = $(event.currentTarget);\n\t\t\tconst name = element.attr('data-tool');\n\n\t\t\tconst tool = this._tools[name];\n\t\t\tif (tool !== undefined) {\n\t\t\t\ttool.onClick();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst generalControl = this._generalControls[name];\n\t\t\tif (generalControl !== undefined) generalControl.onClick();\n\n\t\t\tconst placementControl = this._placementControls[name];\n\t\t\tif (placementControl !== undefined) placementControl.onClick();\n\n\t\t\tconst toolControl = CurvyWallToolManager.instance.activeTool?.getTools()[name];\n\t\t\tif (toolControl !== undefined) {\n\t\t\t\tif (!toolControl.toggleable) toolControl.onClick();\n\t\t\t\telse toolControl.onClick(!toolControl.isActive());\n\t\t\t}\n\n\t\t\tthis.render(false);\n\t\t});\n\t}\n\n\tclose(options?: Application.CloseOptions): Promise<void> {\n\t\tif (!SETTINGS.get(CurvyWallsToolBar.PREF_PRESERVE)) {\n\t\t\tthis._closing = true;\n\t\t\tCurvyWallToolManager.instance.mode = Mode.None;\n\t\t}\n\t\treturn super.close(options);\n\t}\n}","import { BezierTool, ToolMode } from './tools/BezierTool';\nimport CircleTool from './tools/CircleTool';\nimport RectangleTool from './tools/RectangleTool';\nimport CubicTool from './tools/CubicTool';\nimport QuadTool from './tools/QuadTool';\nimport { InputHandler } from './tools/ToolInputHandler';\nimport PointMapper from './tools/PointMapper';\nimport SETTINGS from \"../../common/Settings\";\nimport { WallData } from '@league-of-foundry-developers/foundry-vtt-types/src/foundry/common/data/data.mjs';\n\ndeclare global {\n\tnamespace PIXI {\n\t\tinterface InteractionData {\n\t\t\torigin: PIXI.Point;\n\t\t\tdestination: PIXI.Point;\n\t\t}\n\t}\n}\n\nexport enum Mode {\n\tNone,\n\tCube,\n\tQuad,\n\tCirc,\n\tRect\n}\n\nconst MODE_NAMES: { [key: number]: string } = {};\nMODE_NAMES[Mode.None] = 'undefined';\nMODE_NAMES[Mode.Cube] = 'beziercube';\nMODE_NAMES[Mode.Quad] = 'bezierquad';\nMODE_NAMES[Mode.Circ] = 'beziercirc';\nMODE_NAMES[Mode.Rect] = 'bezierrect';\nclass WallPool {\n\tstatic readonly walls: Wall[] = [];\n\tstatic acquire(wallData: WallData): Wall {\n\t\tconst result = this.walls.pop() ?? new Wall(new WallDocument(wallData, { parent: canvas.scene }));\n\t\tresult.data = wallData;\n\t\treturn result;\n\t}\n\tstatic release(wall: Wall) { this.walls.push(wall); }\n}\n\nexport class CurvyWallToolManager {\n\tstatic readonly PREF_DROP_KEY = 'drop-key';\n\tprivate static _instance: CurvyWallToolManager;\n\tprivate _mode = Mode.None;\n\tprivate wallsLayer: WallsLayer;\n\tprivate walls: Wall[] = [];\n\tprivate currentHandler?: InputHandler = null;\n\tprivate _activeTool?: BezierTool = null;\n\tprivate _modeListener: (mode: Mode, toolMode: ToolMode | null) => void = null;\n\tprivate _ignoreNextToolModeChange = false;\n\tprivate _previousToolData = new Map<Mode, object>([\n\t\t[Mode.Cube, { l1: [-100, 0], l2: [100, 0], c1: [-100, -132], c2: [100, -132] }],\n\t\t[Mode.Quad, { l1: [-100, 0], l2: [100, 0], c: [0, -132] }],\n\t\t[Mode.Circ, { l1: [-100, -100], l2: [100, 100], a1: 0, a2: 0 }],\n\t\t[Mode.Rect, { l1: [-100, -100], l2: [100, 100], t: 1, r: 1, b: 1, l: 1 }],\n\t]);\n\tprivate _pointMapper = new PointMapper();\n\tprivate _notification: any;\n\n\tget segments(): number { return this._activeTool.segments; }\n\tset segments(value: number) {\n\t\tthis._activeTool.segments = Math.clamped(value, 1, 64);\n\t\tif (this.mode != Mode.None)\n\t\t\tthis.render();\n\t}\n\tget activeTool(): BezierTool | null { return this._activeTool; }\n\n\tprivate _inPointMapMode = false;\n\tget currentlyMappingPoints(): boolean { return this._inPointMapMode; }\n\n\t// eslint-disable-next-line @typescript-eslint/no-empty-function\n\tprivate constructor() { }\n\tpublic static get instance(): CurvyWallToolManager {\n\t\treturn this._instance || (this._instance = new this());\n\t}\n\n\tget mode(): Mode { return this._mode; }\n\tset mode(value: Mode) {\n\t\tif (this._mode === value) return;\n\t\tthis._ignoreNextToolModeChange = this.activeTool?.mode !== ToolMode.NotPlaced;\n\t\tthis.clearTool();\n\t\tif (this._inPointMapMode)\n\t\t\tthis.togglePointMapping();\n\t\tthis._mode = value;\n\t\tif (this._inPointMapMode)\n\t\t\tthis._pointMapper.points = [];\n\t\tswitch (value) {\n\t\t\tcase Mode.None:\n\t\t\t\tthis._activeTool = null;\n\t\t\t\tbreak;\n\t\t\tcase Mode.Cube:\n\t\t\t\tthis._activeTool = new CubicTool();\n\t\t\t\tbreak;\n\t\t\tcase Mode.Quad:\n\t\t\t\tthis._activeTool = new QuadTool();\n\t\t\t\tbreak;\n\t\t\tcase Mode.Circ:\n\t\t\t\tthis._activeTool = new CircleTool();\n\t\t\t\tbreak;\n\t\t\tcase Mode.Rect:\n\t\t\t\tthis._activeTool = new RectangleTool();\n\t\t\t\tbreak;\n\t\t}\n\t\tthis._activeTool?.setModeListener((toolMode: ToolMode) => {\n\t\t\tif (this._ignoreNextToolModeChange) {\n\t\t\t\tthis._ignoreNextToolModeChange = false;\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (this._modeListener !== null)\n\t\t\t\tthis._modeListener(this._mode, toolMode);\n\t\t});\n\t\tif (this._modeListener !== null)\n\t\t\tthis._modeListener(value, this.activeTool?.mode);\n\t}\n\tsetModeListener(listener: (mode: Mode, toolMode: ToolMode | null) => void) {\n\t\tthis._modeListener = listener;\n\t}\n\n\tasync apply() {\n\t\tif (!this.activeTool || this.activeTool.mode != ToolMode.Placed) return;\n\t\tawait game.scenes.viewed.createEmbeddedDocuments(\"Wall\", <any>this.walls.map(e => e.data));\n\t\tthis.clearTool();\n\t}\n\n\tclearTool() {\n\t\tif (!this._activeTool) {\n\t\t\tthis._ignoreNextToolModeChange = false;\n\t\t\treturn;\n\t\t}\n\t\tthis._activeTool.clearTool();\n\t\tthis.walls = [];\n\t\tthis.wallsLayer.preview.removeChildren();\n\t\tthis.render();\n\t}\n\n\ttogglePointMapping() {\n\t\tthis._inPointMapMode = !this._inPointMapMode;\n\t\tif (this._inPointMapMode) {\n\t\t\tthis._pointMapper.points = [];\n\t\t\tui.notifications.info(game.i18n.localize(this._pointMapper.getTooltipMessage()), { permanent: true });\n\t\t} else {\n\t\t\tui.notifications.active.forEach(x => x.remove());\n\t\t\tui.notifications.active = [];\n\t\t}\n\t\tthis.render();\n\t}\n\tget canApplyPointMapping(): boolean {\n\t\treturn this._pointMapper.hasEnoughData();\n\t}\n\tapplyPointMapping() {\n\t\tif (!this._inPointMapMode) return;\n\t\tthis._inPointMapMode = false;\n\t\tthis._pointMapper.bindData(this._activeTool);\n\t\t(<any>this._activeTool).setMode(ToolMode.Placed);\n\t\tui.notifications.active.forEach(x => x.remove());\n\t\tui.notifications.active = [];\n\t\tthis.render();\n\t}\n\n\tstatic _onClickLeft(wrapped: AnyFunction, event: PIXI.InteractionEvent) {\n\t\tconst self = CurvyWallToolManager.instance;\n\t\tif (self._inPointMapMode) {\n\t\t\tif (!self._pointMapper.checkPointForClick(event.data.origin, event))\n\t\t\t\treturn;\n\t\t\tif (self._pointMapper.hasEnoughData())\n\t\t\t\tself._modeListener(self.mode, ToolMode.NotPlaced);\n\t\t\tself.render();\n\t\t\treturn;\n\t\t}\n\n\t\tif (self.mode == Mode.None || self.activeTool == null) return wrapped(event);\n\t\tif (self.activeTool.checkPointForClick(event.data.origin, event)) {\n\t\t\tself.render();\n\t\t\treturn;\n\t\t}\n\t\tif (event.data.originalEvent.ctrlKey) {\n\t\t\tself.activeTool.startedWithCtrlHeld = true;\n\t\t}\n\t\tif (SETTINGS.get(CurvyWallToolManager.PREF_DROP_KEY) === 'ctrl' && !event.data.originalEvent.ctrlKey) return;\n\t\tif (SETTINGS.get(CurvyWallToolManager.PREF_DROP_KEY) === 'alt' && !event.data.originalEvent.altKey) return;\n\t\tself.activeTool.placeTool(event.data.origin, self._previousToolData.get(self._mode));\n\t\tself.render();\n\t}\n\tstatic _onDragLeftStart(wrapped: AnyFunction, event: PIXI.InteractionEvent) {\n\t\tconst self = CurvyWallToolManager.instance;\n\t\tif (self._inPointMapMode) {\n\t\t\tself.currentHandler = self._pointMapper.checkPointForDrag(event.data.origin);\n\t\t\tif (self.currentHandler == null) return;\n\t\t\tself.currentHandler.start(event.data.origin, event.data.destination, event);\n\t\t\tself.render();\n\t\t\treturn;\n\t\t}\n\t\tif (self.mode == Mode.None || self.activeTool == null) return wrapped(event);\n\t\tself.currentHandler = self.activeTool.checkPointForDrag(event.data.origin);\n\t\tif (self.currentHandler == null) return;\n\t\tself.currentHandler.start(event.data.origin, event.data.destination, event);\n\t\tself.render();\n\t}\n\tstatic _onDragLeftMove(wrapped: AnyFunction, event: PIXI.InteractionEvent) {\n\t\tconst self = CurvyWallToolManager.instance;\n\t\tif (self.mode == Mode.None || !self.currentHandler) return wrapped(event);\n\t\tif (self.activeTool.startedWithCtrlHeld && !event.data.originalEvent.ctrlKey) {\n\t\t\tself.activeTool.startedWithCtrlHeld = false;\n\t\t}\n\t\tself.currentHandler.move(event.data.origin, event.data.destination, event);\n\t\tself.render();\n\t}\n\tstatic _onDragLeftDrop(wrapped: AnyFunction, event: PIXI.InteractionEvent) {\n\t\tconst self = CurvyWallToolManager.instance;\n\t\tif (self.mode == Mode.None || !self.currentHandler) return wrapped(event);\n\t\tself.activeTool.startedWithCtrlHeld = false;\n\t\tself.currentHandler.stop(event.data.origin, event.data.destination, event);\n\t\tself.currentHandler = null;\n\t\tself.render();\n\t}\n\tstatic _onDragLeftCancel(wrapped: AnyFunction, event: PIXI.InteractionEvent) {\n\t\tconst self = CurvyWallToolManager.instance;\n\t\tif (self.mode == Mode.None) return wrapped(event);\n\t\telse if (!self.currentHandler) return;\n\t\tself.currentHandler.cancel();\n\t\tself.currentHandler = null;\n\t\tself.render();\n\t}\n\tstatic _onClickRight(wrapped: AnyFunction, event: PIXI.InteractionEvent) {\n\t\tconst self = CurvyWallToolManager.instance;\n\t\tif (!event.data.originalEvent.ctrlKey || self.mode == Mode.None) return wrapped(event);\n\t\tself.mode = Mode.None;\n\t\tself.render();\n\t}\n\n\tprivate graphicsContext = new PIXI.Graphics(null);\n\trender() {\n\t\tthis.wallsLayer.preview.removeChildren();\n\t\tif (this.currentlyMappingPoints) {\n\t\t\tthis._pointMapper.clearContext(this.graphicsContext);\n\t\t\tthis.graphicsContext.clear();\n\t\t\tthis.graphicsContext.removeChildren();\n\t\t\tthis.wallsLayer.preview.addChild(this.graphicsContext);\n\t\t\tthis._pointMapper.drawHandles(this.graphicsContext);\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.activeTool == null) return;\n\t\tconst pointData = this.activeTool?.getSegments(this.segments);\n\t\tif (pointData.length == 0) return;\n\t\tthis.walls.length;\n\t\tconst wallData = (<any>this.wallsLayer)._getWallDataFromActiveTool(game.activeTool) as WallData;\n\n\t\twhile (this.walls.length > pointData.length - 1) {\n\t\t\tconst wall = this.walls.pop();\n\t\t\tWallPool.release(wall);\n\t\t\tthis.wallsLayer.preview.removeChild(wall);\n\t\t}\n\t\tif ((<PIXI.Point>pointData[0]).x !== undefined) {\n\t\t\tconst points = pointData as PIXI.Point[];\n\t\t\tfor (let c = 0; c < points.length - 1; c++) {\n\t\t\t\tconst data = duplicate(wallData) as WallData;\n\t\t\t\tdata.c = [points[c].x, points[c].y, points[c + 1].x, points[c + 1].y];\n\t\t\t\tif (c == this.walls.length) {\n\t\t\t\t\tthis.walls.push(WallPool.acquire(data));\n\t\t\t\t\tthis.wallsLayer.preview.addChild(this.walls[c]);\n\t\t\t\t\tthis.walls[c].draw();\n\t\t\t\t} else {\n\t\t\t\t\tthis.walls[c].data = data;\n\t\t\t\t\tthis.wallsLayer.preview.addChild(this.walls[c]);\n\t\t\t\t\tthis.walls[c].refresh();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse if ((<PIXI.Point>(<PIXI.Point[]>pointData[0])[0]).x !== undefined) {\n\t\t\tconst points = pointData as PIXI.Point[][];\n\t\t\tif (this.walls.length > points.length) {\n\t\t\t\tconst wall = this.walls.pop();\n\t\t\t\tWallPool.release(wall);\n\t\t\t\tthis.wallsLayer.preview.removeChild(wall);\n\t\t\t}\n\t\t\tfor (let c = 0; c < points.length; c++) {\n\t\t\t\tconst data = duplicate(wallData) as WallData;\n\t\t\t\tdata.c = [points[c][0].x, points[c][0].y, points[c][1].x, points[c][1].y];\n\t\t\t\tif (c == this.walls.length) {\n\t\t\t\t\tthis.walls.push(WallPool.acquire(data));\n\t\t\t\t\tthis.wallsLayer.preview.addChild(this.walls[c]);\n\t\t\t\t\tthis.walls[c].draw();\n\t\t\t\t} else {\n\t\t\t\t\tthis.walls[c].data = data;\n\t\t\t\t\tthis.wallsLayer.preview.addChild(this.walls[c]);\n\t\t\t\t\tthis.walls[c].refresh();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis.activeTool.clearContext(this.graphicsContext);\n\t\tthis.graphicsContext.removeChildren().forEach(x => x.destroy());\n\t\tthis.graphicsContext.clear();\n\t\tthis.graphicsContext.visible = true;\n\t\tthis.wallsLayer.preview.addChild(this.graphicsContext);\n\t\tthis.activeTool.drawHandles(this.graphicsContext);\n\t\tthis._previousToolData.set(this._mode, this.activeTool.getData());\n\t}\n\n\tpatchWallsLayer() {\n\t\tthis.wallsLayer = canvas.walls;\n\t\tconst MOD_NAME = 'df-curvy-walls';\n\t\tlibWrapper.register(MOD_NAME, 'WallsLayer.prototype._onClickLeft', CurvyWallToolManager._onClickLeft, 'MIXED');\n\t\tlibWrapper.register(MOD_NAME, 'WallsLayer.prototype._onDragLeftStart', CurvyWallToolManager._onDragLeftStart, 'MIXED');\n\t\tlibWrapper.register(MOD_NAME, 'WallsLayer.prototype._onDragLeftMove', CurvyWallToolManager._onDragLeftMove, 'MIXED');\n\t\tlibWrapper.register(MOD_NAME, 'WallsLayer.prototype._onDragLeftDrop', CurvyWallToolManager._onDragLeftDrop, 'MIXED');\n\t\tlibWrapper.register(MOD_NAME, 'WallsLayer.prototype._onDragLeftCancel', CurvyWallToolManager._onDragLeftCancel, 'MIXED');\n\t\tlibWrapper.register(MOD_NAME, 'WallsLayer.prototype._onClickRight', CurvyWallToolManager._onClickRight, 'MIXED');\n\t\tHooks.on('requestCurvyWallsRedraw', () => this.render());\n\t}\n}\n","import { InputHandler } from \"./ToolInputHandler\";\nimport { CurvyWallControl } from '../CurvyWallsToolBar';\nimport SETTINGS from \"../../../common/Settings\";\n\nexport enum ToolMode {\n\tNotPlaced,\n\tPlacing,\n\tPlaced\n}\n\nexport abstract class BezierTool {\n\tpublic static readonly PREF_SMALL_HANDLES = \"BezierTool.SmallHandles\";\n\tpublic static get HANDLE_RADIUS(): number {\n\t\treturn SETTINGS.get(this.PREF_SMALL_HANDLES) ? 5 : 10;\n\t}\n\tpublic static readonly LINE_SIZE: number = 2;\n\tprivate static readonly TEXT_STYLE_BASE = new PIXI.TextStyle({\n\t\tfontFamily: CONFIG.defaultFontFamily,\n\t\tfontSize: 24,\n\t\tfill: \"#BBBBBB\",\n\t\tstroke: \"#111111\",\n\t\tstrokeThickness: 4,\n\t\tdropShadow: false,\n\t\tdropShadowColor: \"#000000\",\n\t\tdropShadowBlur: Math.max(Math.round(24 / 16), 2),\n\t\tdropShadowAngle: 0,\n\t\tdropShadowDistance: 0,\n\t\tpadding: 1\n\t});\n\t// Define the text style\n\tpublic static get TEXT_STYLE(): PIXI.TextStyle {\n\t\tthis.TEXT_STYLE_BASE.fontSize = SETTINGS.get(this.PREF_SMALL_HANDLES) ? 18 : 24;\n\t\treturn this.TEXT_STYLE_BASE;\n\t}\n\n\tprivate _mode: ToolMode = ToolMode.NotPlaced;\n\tprotected lastSegmentFetch: PIXI.Point[] | PIXI.Point[][] = [];\n\tabstract get handles(): PIXI.Point[]\n\tabstract get bounds(): PIXI.Bounds;\n\tabstract lineA: PIXI.Point;\n\tabstract lineB: PIXI.Point;\n\n\tpublic segments: number = 8;\n\n\tget lineCenter(): PIXI.Point {\n\t\treturn new PIXI.Point(\n\t\t\tthis.lineA.x + ((this.lineB.x - this.lineA.x) / 2),\n\t\t\tthis.lineA.y + ((this.lineB.y - this.lineA.y) / 2));\n\t}\n\n\tprivate _modeListener: (mode: ToolMode) => void = null;\n\tget mode(): ToolMode { return this._mode; }\n\tprotected setMode(value: ToolMode) {\n\t\tif (this._mode === value) return;\n\t\tthis._mode = value;\n\t\tif (this._modeListener !== null)\n\t\t\tthis._modeListener(value);\n\t}\n\n\tstartedWithCtrlHeld: boolean = false;\n\n\tconstructor(segments: number = 10) {\n\t\tthis.segments = segments;\n\t}\n\n\tabstract drawHandles(context: PIXI.Graphics): void;\n\tabstract checkPointForDrag(point: PIXI.Point): InputHandler | null;\n\tabstract getSegments(count: number): PIXI.Point[] | PIXI.Point[][];\n\tabstract placeTool(point: PIXI.Point, data: object): void;\n\tabstract getData(): object;\n\tabstract getTools(): Record<string, CurvyWallControl>\n\n\tcheckPointForClick(_point: PIXI.Point, _event: PIXI.InteractionEvent): boolean { return false; }\n\t// eslint-disable-next-line @typescript-eslint/no-empty-function\n\tclearContext(_context: PIXI.Graphics): void { }\n\tclearTool() {\n\t\tthis.setMode(ToolMode.NotPlaced);\n\t}\n\tsetModeListener(listener: (toolMode: ToolMode) => void) {\n\t\tthis._modeListener = listener;\n\t}\n\n\tprotected static createText(text: string): PreciseText {\n\t\tconst result = new PreciseText(text, BezierTool.TEXT_STYLE);\n\t\tresult.anchor.set(0.5, 0.5);\n\t\treturn result;\n\t}\n\tprotected drawSegmentLabel(context: PIXI.Graphics) {\n\t\tconst text = BezierTool.createText(`${this.lastSegmentFetch.length - 1}`);\n\t\ttext.position = this.lineCenter;\n\t\tcontext.addChild(text);\n\t}\n\tprotected drawBoundingBox(context: PIXI.Graphics) {\n\t\tconst bounds = this.bounds.getRectangle(PIXI.Rectangle.EMPTY);\n\t\tcontext.beginFill(0, 0)\n\t\t\t.lineStyle(BezierTool.LINE_SIZE, 0xE88D2D, 1, 0.5)\n\t\t\t.drawRoundedRect(bounds.left - 20, bounds.top - 20, bounds.width + 40, bounds.height + 40, 20)\n\t\t\t.endFill();\n\t}\n\tprotected drawHandle(context: PIXI.Graphics, fill: number, point: PIXI.Point): PIXI.Graphics {\n\t\treturn context.beginFill(fill, 1)\n\t\t\t.lineStyle(BezierTool.LINE_SIZE, 0x0, 1, 0.5)\n\t\t\t.drawCircle(point.x, point.y, BezierTool.HANDLE_RADIUS)\n\t\t\t.endFill();\n\t}\n\n\tstatic pointNearPoint(a: { x: number, y: number }, b: { x: number, y: number }, threshold: number): boolean {\n\t\tconst x = a.x - b.x;\n\t\tconst y = a.y - b.y;\n\t\treturn ((x * x) + (y * y)) <= (threshold * threshold); // super simple and efficient Squared Length circle collision\n\t}\n}","\ndeclare global {\n\tinterface LenientGlobalVariableTypes {\n\t\tgame: never;\n\t\tcanvas: never;\n\t}\n\tinterface String {\n\t\t/** Localizes the string via the global `game.i18n.localize()` function. */\n\t\tlocalize(): string\n\t}\n\ttype AnyFunction = (...args: any) => any;\n}\n\nexport default class SETTINGS {\n\tstatic MOD_NAME: string;\n\tstatic init(moduleName: string) {\n\t\tthis.MOD_NAME = moduleName;\n\t\tif (!String.prototype.localize) {\n\t\t\tString.prototype.localize = function () {\n\t\t\t\treturn game.i18n.localize(this.valueOf());\n\t\t\t};\n\t\t}\n\t}\n\tstatic register<T>(key: string, config: ClientSettings.PartialSetting<T>) { game.settings.register(SETTINGS.MOD_NAME, key, config); }\n\tstatic registerMenu(key: string, config: ClientSettings.PartialMenuSetting) { game.settings.registerMenu(SETTINGS.MOD_NAME, key, config); }\n\tstatic get<T>(key: string): T { return <T>game.settings.get(SETTINGS.MOD_NAME, key); }\n\tstatic async set<T>(key: string, value: T): Promise<T> { return await game.settings.set(SETTINGS.MOD_NAME, key, value); }\n\tstatic default<T>(key: string): T { return <T>game.settings.settings.get(SETTINGS.MOD_NAME + '.' + key).default; }\n\t/** helper for referencing a Typed constructor for the `type` field of a setting { type: SETTINGS.typeOf<MyClass>() } */\n\tstatic typeOf<T>(): ConstructorOf<T> { return Object as any; }\n}\n","import { BezierTool, ToolMode } from './BezierTool';\nimport { PointArrayInputHandler, InputHandler, PointInputHandler, InitializerInputHandler } from \"./ToolInputHandler\";\nimport { CurvyWallControl } from '../CurvyWallsToolBar';\n\nconst pointNearPoint = BezierTool.pointNearPoint;\nconst PI2 = Math.PI * 2;\ndeclare type Point = PIXI.Point;\n\n// Helper function log outputs\n// function degrees(radians: number) { return (radians / Math.PI) * 180.0; }\n\nclass InitializerIH extends InitializerInputHandler {\n\tconstructor(tool: CircleTool, success: () => void, fail: () => void) {\n\t\tsuper(tool, true, tool.lineA, tool.lineB, success, fail);\n\t}\n}\n\nexport default class CircleTool extends BezierTool {\n\tstatic readonly ANGLE_SNAP_STEPS = [Math.PI / 4, Math.PI / 6, Math.PI / 12, Math.PI / 24, Math.PI / 48];\n\tstatic snapSetIndex = 2;\n\tstatic finishSliceIfShort = true;\n\tstatic closeLoopIfSliced = false;\n\tlineA = new PIXI.Point();\n\tlineB = new PIXI.Point();\n\tarcHandle = new RotatorHandle(100);\n\tsliceHandle = new RotatorHandle(75, this.arcHandle);\n\n\tget handles(): Point[] { return [this.lineA, this.lineB]; }\n\tget bounds(): PIXI.Bounds {\n\t\tconst b = new PIXI.Bounds();\n\t\tb.addPoint(this.lineA);\n\t\tb.addPoint(this.lineB);\n\t\treturn b;\n\t}\n\tget polygon(): PIXI.Polygon {\n\t\tconst bounds = this.bounds;\n\t\treturn new PIXI.Polygon([\n\t\t\tbounds.minX, bounds.minY,\n\t\t\tbounds.maxX, bounds.minY,\n\t\t\tbounds.minX, bounds.maxY,\n\t\t\tbounds.maxX, bounds.maxY]);\n\t}\n\n\tprivate _tools: Record<string, CurvyWallControl> = {\n\t\tellipseclose: {\n\t\t\ticon: 'fas fa-adjust',\n\t\t\ttitle: 'df-curvy-walls.ellipse_close',\n\t\t\ttoggleable: true,\n\t\t\tisActive: () => CircleTool.closeLoopIfSliced,\n\t\t\tonClick: enabled => {\n\t\t\t\tCircleTool.closeLoopIfSliced = enabled;\n\t\t\t\tHooks.call('requestCurvyWallsRedraw');\n\t\t\t}\n\t\t},\n\t\tellipsefinish: {\n\t\t\ticon: 'fas fa-compress-alt',\n\t\t\ttitle: 'df-curvy-walls.ellipse_finish_slice',\n\t\t\ttoggleable: true,\n\t\t\tisActive: () => CircleTool.finishSliceIfShort,\n\t\t\tonClick: enabled => {\n\t\t\t\tCircleTool.finishSliceIfShort = enabled;\n\t\t\t\tHooks.call('requestCurvyWallsRedraw');\n\t\t\t}\n\t\t},\n\t\tellipseinc: {\n\t\t\ticon: 'dfcw ellipseinc',\n\t\t\ttitle: 'df-curvy-walls.ellipse_increment',\n\t\t\tonClick: () => {\n\t\t\t\tCircleTool.snapSetIndex = Math.clamped(CircleTool.snapSetIndex + 1, 0, CircleTool.ANGLE_SNAP_STEPS.length - 1);\n\t\t\t\tHooks.call('requestCurvyWallsRedraw');\n\t\t\t}\n\t\t},\n\t\tellipsedec: {\n\t\t\ticon: 'dfcw ellipsedec',\n\t\t\ttitle: 'df-curvy-walls.ellipse_decrement',\n\t\t\tonClick: () => {\n\t\t\t\tCircleTool.snapSetIndex = Math.clamped(CircleTool.snapSetIndex - 1, 0, CircleTool.ANGLE_SNAP_STEPS.length - 1);\n\t\t\t\tHooks.call('requestCurvyWallsRedraw');\n\t\t\t}\n\t\t}\n\t};\n\tgetTools(): Record<string, CurvyWallControl> { return this._tools; }\n\tplaceTool(point: PIXI.Point, data: { l1: number[], l2: number[], a1: number, a2: number }) {\n\t\tthis.lineA.set(data.l1[0] + point.x, data.l1[1] + point.y);\n\t\tthis.lineB.set(data.l2[0] + point.x, data.l2[1] + point.y);\n\t\tthis.arcHandle.angle = data.a1;\n\t\tthis.sliceHandle.angle = data.a2;\n\t\tthis.setMode(ToolMode.Placed);\n\t}\n\tgetData() {\n\t\tconst center = this.lineCenter;\n\t\treturn {\n\t\t\tl1: [this.lineA.x - center.x, this.lineA.y - center.y],\n\t\t\tl2: [this.lineB.x - center.x, this.lineB.y - center.y],\n\t\t\ta1: this.arcHandle.angle, a2: this.sliceHandle.angle\n\t\t};\n\t}\n\n\tgetCenter(): PIXI.Point {\n\t\tconst bounds = this.bounds;\n\t\tconst rect = bounds.getRectangle(PIXI.Rectangle.EMPTY);\n\t\tconst halfWidth = rect.width / 2;\n\t\tconst halfHeight = rect.height / 2;\n\t\treturn new PIXI.Point(bounds.minX + halfWidth, bounds.minY + halfHeight);\n\t}\n\n\tprivate createVector(theta: number, magnitude: Point, origin: Point): Point {\n\t\treturn new PIXI.Point(\n\t\t\torigin.x + (Math.cos(theta) * magnitude.x),\n\t\t\torigin.y + (Math.sin(theta) * magnitude.y)\n\t\t);\n\t}\n\n\tgetSegments(count: number): PIXI.Point[] {\n\t\tif (this.mode == ToolMode.NotPlaced) return [];\n\t\tconst bounds = this.bounds;\n\t\tconst rect = bounds.getRectangle(PIXI.Rectangle.EMPTY);\n\t\tconst deltaTheta = Math.PI / count;\n\t\t// Calculate the magnitude per axis based on the scalar of the circle's x,y radius\n\t\tconst magnitude = new PIXI.Point(rect.width / 2, rect.height / 2);\n\t\t// Find the exact middle point of the circle\n\t\tconst origin = new PIXI.Point(bounds.minX + magnitude.x, bounds.minY + magnitude.y);\n\t\t// initialize with the first point\n\t\tconst points: PIXI.Point[] = [];\n\t\t// Start at full rotation and work our way back CCW\n\t\tlet angle = PI2;\n\t\tconst sliceAngle = this.sliceHandle.rawAngle != PI2 ? this.sliceHandle.rawAngle : 0.0;\n\t\t// console.log(`Slice: ${degrees(sliceAngle)}, Arc: ${degrees(this.arcHandle.rawAngle)}`);\n\t\twhile (angle >= sliceAngle) {\n\t\t\tpoints.push(this.createVector(this.arcHandle.rawAngle + angle, magnitude, origin));\n\t\t\tangle -= deltaTheta;\n\t\t\tif (angle < 1e-10 && angle > -1e-10)\n\t\t\t\tangle = 0;\n\t\t}\n\t\t// If we stopped short of the slice handle, add a small step to go the rest of the way\n\t\tif (CircleTool.finishSliceIfShort && angle != sliceAngle && sliceAngle != 0) {\n\t\t\tpoints.push(this.createVector(this.arcHandle.rawAngle + sliceAngle, magnitude, origin));\n\t\t}\n\t\t// Close loop if there is no slice, or if the user has locked loop closing\n\t\tif (CircleTool.closeLoopIfSliced && sliceAngle != 0)\n\t\t\tpoints.push(points[0]);\n\t\treturn (this.lastSegmentFetch = points);\n\t}\n\n\tinitialPoints(): number[] { return [0, 0, 0, 0, 0, 0]; }\n\tdrawHandles(context: PIXI.Graphics): void {\n\t\tif (this.mode == ToolMode.NotPlaced) return;\n\t\tthis.drawBoundingBox(context);\n\t\tconst middle = this.getCenter();\n\t\tconst arc = this.arcHandle.getHandlePoint(middle);\n\t\tconst slice = this.sliceHandle.getHandlePoint(middle);\n\t\tcontext.beginFill(0xffaacc)\n\t\t\t.lineStyle(BezierTool.LINE_SIZE, 0xffaacc, 1, 0.5)\n\t\t\t.moveTo(this.lineA.x, this.lineA.y)\n\t\t\t.lineTo(this.lineB.x, this.lineB.y)\n\t\t\t.moveTo(middle.x, middle.y)\n\t\t\t.lineTo(arc.x, arc.y)\n\t\t\t.moveTo(middle.x, middle.y)\n\t\t\t.lineTo(slice.x, slice.y)\n\t\t\t.endFill();\n\t\tthis.drawSegmentLabel(context);\n\t\tconst snapAngle = Math.toDegrees(CircleTool.ANGLE_SNAP_STEPS[CircleTool.snapSetIndex]).toFixed(2);\n\t\tconst arcLabel = BezierTool.createText(`${snapAngle}   ${180 / parseFloat(snapAngle)}`);\n\t\tarcLabel.position.copyFrom(this.lineCenter);\n\t\tarcLabel.position.y += BezierTool.TEXT_STYLE.fontSize as number + 4;\n\t\tcontext.addChild(arcLabel);\n\t\tthis.drawHandle(context, 0xff4444, this.lineA);\n\t\tthis.drawHandle(context, 0xff4444, this.lineB);\n\t\tthis.drawHandle(context, 0x44ff44, this.arcHandle.getHandlePoint(this.getCenter()));\n\t\tthis.drawHandle(context, 0x4444ff, this.sliceHandle.getHandlePoint(this.getCenter()));\n\t}\n\tprotected drawSegmentLabel(context: PIXI.Graphics) {\n\t\tconst text = BezierTool.createText(`${this.lastSegmentFetch.length - 1}`);\n\t\ttext.position = this.lineCenter;\n\t\tcontext.addChild(text);\n\t}\n\tcheckPointForDrag(point: Point): InputHandler | null {\n\t\tif (this.mode == ToolMode.NotPlaced) {\n\t\t\tthis.setMode(ToolMode.Placing);\n\t\t\treturn new InitializerIH(this, () => this.setMode(ToolMode.Placed), () => this.setMode(ToolMode.NotPlaced));\n\t\t}\n\t\tif (pointNearPoint(point, this.lineA, BezierTool.HANDLE_RADIUS))\n\t\t\treturn new PointInputHandler(this, this.lineA, null, this.lineB);\n\t\telse if (pointNearPoint(point, this.lineB, BezierTool.HANDLE_RADIUS))\n\t\t\treturn new PointInputHandler(this, this.lineB, null, this.lineA);\n\t\telse if (pointNearPoint(point, this.arcHandle.getHandlePoint(this.getCenter()), BezierTool.HANDLE_RADIUS))\n\t\t\treturn new PointRotationHandler(this, this.arcHandle, this.getCenter());\n\t\telse if (pointNearPoint(point, this.sliceHandle.getHandlePoint(this.getCenter()), BezierTool.HANDLE_RADIUS))\n\t\t\treturn new PointRotationHandler(this, this.sliceHandle, this.getCenter());\n\t\telse if (this.polygon.contains(point.x, point.y))\n\t\t\treturn new PointArrayInputHandler(this, point, this.handles);\n\t\treturn null;\n\t}\n}\n\nclass RotatorHandle {\n\tprivate _angle: number = 0.0;\n\tget rawAngle(): number { return this._angle; }\n\tset rawAngle(value: number) { this._angle = value; }\n\tget angle(): number {\n\t\treturn this.magnet ? this._angle + this.magnet._angle : this._angle;\n\t}\n\tset angle(value: number) {\n\t\tthis._angle = this.magnet ? value - this.magnet._angle : this._angle = value;\n\t}\n\tprivate length: number = 0.0;\n\tmagnet: RotatorHandle;\n\tconstructor(length: number, magnet?: RotatorHandle) {\n\t\tthis.length = length;\n\t\tthis.magnet = magnet;\n\t}\n\tgetHandlePoint(center: PIXI.Point): PIXI.Point {\n\t\tconst magnet = this.magnet ? this.magnet._angle : 0;\n\t\tconst ax = Math.cos(magnet + this._angle) * this.length;\n\t\tconst ay = Math.sin(magnet + this._angle) * this.length;\n\t\treturn new PIXI.Point(center.x + ax, center.y + ay);\n\t}\n}\n\nclass PointRotationHandler extends InputHandler {\n\tprivate original: number;\n\tprivate arcHandle: RotatorHandle;\n\tprivate center: PIXI.Point;\n\tconstructor(tool: BezierTool, arcHandle: RotatorHandle, center: PIXI.Point) {\n\t\tsuper(tool);\n\t\tthis.arcHandle = arcHandle;\n\t\tthis.original = this.arcHandle.angle;\n\t\tthis.center = center;\n\t}\n\n\tsetAngle(to: PIXI.Point, event: PIXI.InteractionEvent) {\n\t\tconst vecX = to.x - this.center.x;\n\t\tconst vecY = to.y - this.center.y;\n\t\t// calculate the reference angle theta bar ()\n\t\tlet angle = Math.atan(vecY / vecX);\n\t\t// If on the -X axis (2nd and 3rd quadrants)\n\t\tif (vecX < 0) angle += Math.PI;\n\t\t// Specifically the +X,-Y quadrant (4th quadrant)\n\t\telse if (vecY < 0) angle += PI2;\n\t\t// Perform snapping if enabled\n\t\tif (this.shouldSnap(event)) {\n\t\t\tconst snapAngle = CircleTool.ANGLE_SNAP_STEPS[CircleTool.snapSetIndex];\n\t\t\t// Whole number of angle snaps\n\t\t\tconst whole = Math.trunc(angle / snapAngle);\n\t\t\t// Round to the nearest whole angle snap\n\t\t\tangle = (angle - (whole * snapAngle)) < (snapAngle / 2)\n\t\t\t\t? whole * snapAngle\n\t\t\t\t: (whole + 1) * snapAngle;\n\t\t}\n\t\tconst magnet = this.arcHandle.magnet ? (PI2 - this.arcHandle.magnet.rawAngle) : 0;\n\t\tthis.arcHandle.rawAngle = (magnet + angle) % PI2;\n\t}\n\n\tstart(_origin: PIXI.Point, destination: PIXI.Point, event: PIXI.InteractionEvent): void {\n\t\tthis.setAngle(destination, event);\n\t}\n\tmove(_origin: PIXI.Point, destination: PIXI.Point, event: PIXI.InteractionEvent): void {\n\t\tthis.setAngle(destination, event);\n\t}\n\tstop(_origin: PIXI.Point, destination: PIXI.Point, event: PIXI.InteractionEvent): void {\n\t\tthis.setAngle(destination, event);\n\t}\n\tcancel(): void {\n\t\tthis.arcHandle.angle = this.original;\n\t}\n}","import { BezierTool } from \"./BezierTool\";\n\ndeclare type Point = PIXI.Point;\nexport abstract class InputHandler {\n\tprivate _tool: BezierTool;\n\tget tool(): BezierTool { return this._tool; }\n\tconstructor(tool: BezierTool) {\n\t\tthis._tool = tool;\n\t}\n\n\tabstract start(origin: Point, destination: Point, event: PIXI.InteractionEvent): void;\n\tabstract move(origin: Point, destination: Point, event: PIXI.InteractionEvent): void;\n\tabstract stop(origin: Point, destination: Point, event: PIXI.InteractionEvent): void;\n\tabstract cancel(): void;\n\tstatic finalPoint(point: Point, snap: boolean = true) {\n\t\treturn (<any>(<Canvas>canvas).walls)._getWallEndpointCoordinates(point, { snap: snap });\n\t}\n\n\tprotected get walls(): WallsLayer { return (canvas as any).walls as WallsLayer; }\n\n\tshouldSnap(event: PIXI.InteractionEvent) {\n\t\tconst { originalEvent } = event.data;\n\t\treturn (<any>this.walls)._forceSnap || !originalEvent.shiftKey;\n\t}\n\n\tgetWallEndPoint(origin: PIXI.Point, snap: boolean): PIXI.Point {\n\t\t// Determine the starting coordinates\n\t\treturn new PIXI.Point(...(<any>this.walls)._getWallEndpointCoordinates(origin, { snap }));\n\t}\n\n\tstatic squarePoint(origin: Point, destination: Point): PIXI.Point {\n\t\t/*\t\n\t\t\t 4  1 \n\t\t\t\n\t\t\t 3  2 \n\t\t\t\t*/\n\t\tconst min = Math.max(Math.abs(destination.x - origin.x), Math.abs(destination.y - origin.y));\n\t\tif (destination.x > origin.x) {\n\t\t\t// Quadrant 1\n\t\t\tif (destination.y < origin.y)\n\t\t\t\treturn new PIXI.Point(origin.x + min, origin.y - min);\n\t\t\t// Quadrant 2\n\t\t\telse return new PIXI.Point(origin.x + min, origin.y + min);\n\t\t}\n\t\t// Quadrant 3\n\t\telse if (destination.y > origin.y)\n\t\t\treturn new PIXI.Point(origin.x - min, origin.y + min);\n\t\t// Quadrant 4\n\t\telse return new PIXI.Point(origin.x - min, origin.y - min);\n\t}\n}\n\nexport abstract class InitializerInputHandler extends InputHandler {\n\tlineA: Point;\n\tlineB: Point;\n\tprotected squaring: boolean;\n\tprotected success: () => void;\n\tprotected fail: () => void;\n\tconstructor(tool: BezierTool, squaring: boolean, lineA: Point, lineB: Point, success: () => void, fail: () => void) {\n\t\tsuper(tool);\n\t\tthis.lineA = lineA;\n\t\tthis.lineB = lineB;\n\t\tthis.squaring = squaring;\n\t\tthis.success = success;\n\t\tthis.fail = fail;\n\t}\n\tstart(origin: Point, destination: Point, event: PIXI.InteractionEvent) {\n\t\tconst snap = this.shouldSnap(event);\n\t\tthis.lineA.copyFrom(this.getWallEndPoint(origin, snap) as PIXI.Point);\n\t\tthis.lineB.copyFrom(this.getWallEndPoint(destination, snap) as PIXI.Point);\n\t}\n\tmove(origin: Point, destination: Point, event: PIXI.InteractionEvent): void {\n\t\tconst snap = this.shouldSnap(event);\n\t\tconst destPoint = this.squaring && event.data.originalEvent.altKey ? InputHandler.squarePoint(origin, destination) : destination;\n\t\tconst origPoint = !this.tool.startedWithCtrlHeld && event.data.originalEvent.ctrlKey ? new PIXI.Point(origin.x - (destPoint.x - origin.x), origin.y - (destPoint.y - origin.y)) : origin;\n\t\tthis.lineA.copyFrom(this.getWallEndPoint(origPoint, snap) as PIXI.Point);\n\t\tthis.lineB.copyFrom(this.getWallEndPoint(destPoint, snap) as PIXI.Point);\n\t}\n\tstop(origin: Point, destination: Point, event: PIXI.InteractionEvent): void {\n\t\tconst snap = this.shouldSnap(event);\n\t\tif (this.squaring && event.data.originalEvent.altKey)\n\t\t\tthis.lineB.copyFrom(this.getWallEndPoint(InputHandler.squarePoint(origin, destination), snap) as PIXI.Point);\n\t\telse\n\t\t\tthis.lineB.copyFrom(this.getWallEndPoint(destination, snap) as PIXI.Point);\n\t\tthis.success();\n\t}\n\tcancel() {\n\t\tthis.fail();\n\t}\n}\n\nexport class PointInputHandler extends InputHandler {\n\tprivate _origin: Point;\n\tprivate _originalPoint = new PIXI.Point(0, 0);\n\tpoint: Point;\n\tcompletion?: (sender: PointInputHandler) => void = null;\n\tconstructor(tool: BezierTool, destination: Point, completion: (sender: PointInputHandler) => void = null, origin?: Point) {\n\t\tsuper(tool);\n\t\tthis._originalPoint.copyFrom(destination);\n\t\tthis._origin = origin;\n\t\tthis.point = destination;\n\t\tthis.completion = completion;\n\t}\n\tstart(_origin: Point, destination: Point, event: PIXI.InteractionEvent): void {\n\t\tthis.move(null, destination, event);\n\t}\n\tmove(_origin: Point, destination: Point, event: PIXI.InteractionEvent): void {\n\t\tif (!!this._origin && event.data.originalEvent.altKey)\n\t\t\tthis.point.copyFrom(this.getWallEndPoint(InputHandler.squarePoint(this._origin, destination), this.shouldSnap(event)) as PIXI.Point);\n\t\telse\n\t\t\tthis.point.copyFrom(this.getWallEndPoint(destination, this.shouldSnap(event)) as PIXI.Point);\n\t}\n\tstop(_origin: Point, destination: Point, event: PIXI.InteractionEvent): void {\n\t\tif (!!this._origin && event.data.originalEvent.altKey)\n\t\t\tthis.point.copyFrom(this.getWallEndPoint(InputHandler.squarePoint(this._origin, destination), this.shouldSnap(event)) as PIXI.Point);\n\t\telse\n\t\t\tthis.point.copyFrom(this.getWallEndPoint(destination, this.shouldSnap(event)) as PIXI.Point);\n\t\tif (this.completion != null)\n\t\t\tthis.completion(this);\n\t}\n\tcancel() {\n\t\tthis.point.copyFrom(this._originalPoint);\n\t\tif (this.completion != null)\n\t\t\tthis.completion(this);\n\t}\n}\n\nexport class PointArrayInputHandler extends InputHandler {\n\tprivate originalPoints: Point[] = [];\n\tpoints: PIXI.Point[];\n\tprivate _start: Point;\n\tcompletion: (sender: PointArrayInputHandler) => void;\n\tconstructor(tool: BezierTool, start: Point, points: Point[], completion: (sender: PointArrayInputHandler) => void = null) {\n\t\tsuper(tool);\n\t\tpoints.forEach(e => this.originalPoints.push(e.clone()));\n\t\tthis.points = points;\n\t\tthis._start = start;\n\t\tthis.completion = completion;\n\t}\n\tprivate moveAll(to: Point, event: PIXI.InteractionEvent) {\n\t\tconst delta = new PIXI.Point(to.x - this._start.x, to.y - this._start.y);\n\t\tconst snap = this.shouldSnap(event);\n\t\tlet o: PIXI.Point;\n\t\tthis.points.forEach((e, i) => {\n\t\t\to = this.originalPoints[i];\n\t\t\te.copyFrom(this.getWallEndPoint(new PIXI.Point(o.x + delta.x, o.y + delta.y), snap));\n\t\t});\n\t}\n\tstart(_origin: Point, destination: Point, event: PIXI.InteractionEvent): void {\n\t\tthis.moveAll(destination, event);\n\t}\n\tmove(_origin: Point, destination: Point, event: PIXI.InteractionEvent): void {\n\t\tthis.moveAll(destination, event);\n\t}\n\tstop(_origin: Point, destination: Point, event: PIXI.InteractionEvent): void {\n\t\tthis.moveAll(destination, event);\n\t\tif (this.completion != null)\n\t\t\tthis.completion(this);\n\t}\n\tcancel() {\n\t\tthis.originalPoints.forEach((e, i) => e.copyTo(this.points[i]));\n\t\tif (this.completion != null)\n\t\t\tthis.completion(this);\n\t}\n}\n\nexport class MagnetPointInputHandler extends InputHandler {\n\tprivate originalPoint = new PIXI.Point(0, 0);\n\tprotected masterPoint: Point;\n\tprotected slavePoint: Point;\n\tprotected offsetX: number;\n\tprotected offsetY: number;\n\tcompletion?: (sender: MagnetPointInputHandler) => void = null;\n\tconstructor(tool: BezierTool, masterPoint: Point, slavePoint: Point, completion: (sender: MagnetPointInputHandler) => void = null) {\n\t\tsuper(tool);\n\t\tthis.originalPoint.copyFrom(masterPoint);\n\t\tthis.masterPoint = masterPoint;\n\t\tthis.slavePoint = slavePoint;\n\t\tthis.offsetX = slavePoint.x - masterPoint.x;\n\t\tthis.offsetY = slavePoint.y - masterPoint.y;\n\t\tthis.completion = completion;\n\t}\n\tstart(_origin: Point, destination: Point, event: PIXI.InteractionEvent): void {\n\t\tthis.move(null, destination, event);\n\t}\n\tmove(_origin: Point, destination: Point, event: PIXI.InteractionEvent): void {\n\t\tthis.masterPoint.copyFrom(this.getWallEndPoint(destination, this.shouldSnap(event)) as PIXI.Point);\n\t\tthis.slavePoint.set(this.masterPoint.x + this.offsetX, this.masterPoint.y + this.offsetY);\n\t}\n\tstop(_origin: Point, destination: Point, event: PIXI.InteractionEvent): void {\n\t\tthis.masterPoint.copyFrom(this.getWallEndPoint(destination, this.shouldSnap(event)) as PIXI.Point);\n\t\tthis.slavePoint.set(this.masterPoint.x + this.offsetX, this.masterPoint.y + this.offsetY);\n\t\tif (this.completion != null)\n\t\t\tthis.completion(this);\n\t}\n\tcancel() {\n\t\tthis.masterPoint.copyFrom(this.originalPoint);\n\t\tthis.slavePoint.set(this.masterPoint.x + this.offsetX, this.masterPoint.y + this.offsetY);\n\t\tif (this.completion != null)\n\t\t\tthis.completion(this);\n\t}\n}","import { CurvyWallControl } from \"../CurvyWallsToolBar\";\nimport { BezierTool, ToolMode } from \"./BezierTool\";\nimport { InitializerInputHandler, InputHandler, PointArrayInputHandler, PointInputHandler } from \"./ToolInputHandler\";\n\nconst pointNearPoint = BezierTool.pointNearPoint;\n\nclass InitializerIH extends InitializerInputHandler {\n\tconstructor(tool: RectangleTool, success: () => void, fail: () => void) {\n\t\tsuper(tool, true, tool.lineA, tool.lineB, success, fail);\n\t}\n}\n\nexport default class RectangleTool extends BezierTool {\n\tlineA = new PIXI.Point();\n\tlineB = new PIXI.Point();\n\tprivate lastCount = 0;\n\tprivate topCount = 0;\n\tprivate rightCount = 0;\n\tprivate bottomCount = 0;\n\tprivate leftCount = 0;\n\tprivate buttonRadius = 50;\n\tprivate buttonOffset = 15;\n\tprivate incTop: PreciseText;\n\tprivate decTop: PreciseText;\n\tprivate incRight: PreciseText;\n\tprivate decRight: PreciseText;\n\tprivate incBottom: PreciseText;\n\tprivate decBottom: PreciseText;\n\tprivate incLeft: PreciseText;\n\tprivate decLeft: PreciseText;\n\tprivate textTop: PreciseText;\n\tprivate textRight: PreciseText;\n\tprivate textBottom: PreciseText;\n\tprivate textLeft: PreciseText;\n\n\tprivate static readonly STYLE = new PIXI.TextStyle({\n\t\tfontFamily: CONFIG.defaultFontFamily,\n\t\tfontSize: 48,\n\t\tfill: \"#BBBBBB\",\n\t\tstroke: \"#111111\",\n\t\tstrokeThickness: 4,\n\t\tdropShadow: true,\n\t\tdropShadowColor: \"#000000\",\n\t\tdropShadowBlur: Math.max(Math.round(24 / 16), 2),\n\t\tdropShadowAngle: 0,\n\t\tdropShadowDistance: 0,\n\t\tpadding: 1\n\t});\n\n\tget handles(): PIXI.Point[] { return [this.lineA, this.lineB]; }\n\tget bounds(): PIXI.Bounds {\n\t\tconst b = new PIXI.Bounds();\n\t\tb.addPoint(this.lineA);\n\t\tb.addPoint(this.lineB);\n\t\treturn b;\n\t}\n\tget rect(): PIXI.Rectangle { return new PIXI.Rectangle(this.lineA.x, this.lineA.y, this.lineB.x, this.lineB.y); }\n\n\tconstructor() {\n\t\tsuper(1);\n\t\tthis.incTop = RectangleTool.createLineLabel('+');\n\t\tthis.decTop = RectangleTool.createLineLabel('-');\n\t\tthis.incRight = RectangleTool.createLineLabel('+');\n\t\tthis.decRight = RectangleTool.createLineLabel('-');\n\t\tthis.incBottom = RectangleTool.createLineLabel('+');\n\t\tthis.decBottom = RectangleTool.createLineLabel('-');\n\t\tthis.incLeft = RectangleTool.createLineLabel('+');\n\t\tthis.decLeft = RectangleTool.createLineLabel('-');\n\t\tthis.textTop = BezierTool.createText('');\n\t\tthis.textRight = BezierTool.createText('');\n\t\tthis.textBottom = BezierTool.createText('');\n\t\tthis.textLeft = BezierTool.createText('');\n\t\tthis.incTop.tint = 0xaaff44;\n\t\tthis.incBottom.tint = 0xaaff44;\n\t\tthis.incRight.tint = 0xaaff44;\n\t\tthis.incLeft.tint = 0xaaff44;\n\t\tthis.decTop.tint = 0xff4444;\n\t\tthis.decBottom.tint = 0xff4444;\n\t\tthis.decRight.tint = 0xff4444;\n\t\tthis.decLeft.tint = 0xff4444;\n\t\tthis.textRight.rotation = Math.PI / 2;\n\t\tthis.textLeft.rotation = -Math.PI / 2;\n\t}\n\n\tprivate static createLineLabel(text: string): PreciseText {\n\t\tconst result = new PreciseText(text, RectangleTool.STYLE);\n\t\tresult.anchor.set(0.5, 0.5);\n\t\treturn result;\n\t}\n\n\tclearContext(context: PIXI.Graphics) {\n\t\tsuper.clearContext(context);\n\t\tcontext.removeChild(this.incTop);\n\t\tcontext.removeChild(this.decTop);\n\t\tcontext.removeChild(this.incRight);\n\t\tcontext.removeChild(this.decRight);\n\t\tcontext.removeChild(this.incBottom);\n\t\tcontext.removeChild(this.decBottom);\n\t\tcontext.removeChild(this.incLeft);\n\t\tcontext.removeChild(this.decLeft);\n\t\tcontext.removeChild(this.textTop);\n\t\tcontext.removeChild(this.textRight);\n\t\tcontext.removeChild(this.textBottom);\n\t\tcontext.removeChild(this.textLeft);\n\t}\n\tdrawHandles(context: PIXI.Graphics) {\n\t\tif (this.mode == ToolMode.NotPlaced) return;\n\t\tthis.drawBoundingBox(context);\n\t\tcontext.beginFill(0xffaacc)\n\t\t\t.lineStyle(BezierTool.LINE_SIZE, 0xffaacc, 1, 0.5)\n\t\t\t.moveTo(this.lineA.x, this.lineA.y)\n\t\t\t.lineTo(this.lineB.x, this.lineB.y)\n\t\t\t.endFill();\n\t\tthis.drawSegmentLabels(context);\n\t\tthis.drawButtons(context);\n\t\tthis.drawHandle(context, 0xff4444, this.lineA);\n\t\tthis.drawHandle(context, 0xaaff44, this.lineB);\n\t}\n\tprotected drawSegmentLabels(context: PIXI.Graphics) {\n\t\tthis.textTop.text = `${Math.trunc(this.topCount + this.lastCount)}`;\n\t\tthis.textRight.text = `${Math.trunc(this.rightCount + this.lastCount)}`;\n\t\tthis.textBottom.text = `${Math.trunc(this.bottomCount + this.lastCount)}`;\n\t\tthis.textLeft.text = `${Math.trunc(this.leftCount + this.lastCount)}`;\n\t\tconst offset = 25;\n\t\tconst bounds = this.bounds;\n\t\tthis.textTop.position = new PIXI.Point(this.lineCenter.x, bounds.minY - offset);\n\t\tthis.textBottom.position = new PIXI.Point(this.lineCenter.x, bounds.maxY + offset);\n\t\tthis.textLeft.position = new PIXI.Point(bounds.minX - offset, this.lineCenter.y);\n\t\tthis.textRight.position = new PIXI.Point(bounds.maxX + offset, this.lineCenter.y);\n\t\tcontext.addChild(this.textTop, this.textRight, this.textBottom, this.textLeft);\n\t}\n\tprotected drawButtons(context: PIXI.Graphics) {\n\t\t// Add buttons to each side for inc/dec segment count on that side.\n\t\tconst center = this.lineCenter;\n\n\t\tthis.incTop.position = new PIXI.Point(center.x + this.buttonOffset, center.y - this.buttonRadius);\n\t\tthis.decTop.position = new PIXI.Point(center.x - this.buttonOffset, center.y - this.buttonRadius);\n\t\tthis.incBottom.position = new PIXI.Point(center.x + this.buttonOffset, center.y + this.buttonRadius);\n\t\tthis.decBottom.position = new PIXI.Point(center.x - this.buttonOffset, center.y + this.buttonRadius);\n\t\tthis.incLeft.position = new PIXI.Point(center.x - this.buttonRadius, center.y - this.buttonOffset);\n\t\tthis.decLeft.position = new PIXI.Point(center.x - this.buttonRadius, center.y + this.buttonOffset);\n\t\tthis.incRight.position = new PIXI.Point(center.x + this.buttonRadius, center.y - this.buttonOffset);\n\t\tthis.decRight.position = new PIXI.Point(center.x + this.buttonRadius, center.y + this.buttonOffset);\n\n\t\tcontext.addChild(this.incTop, this.decTop, this.incRight, this.decRight,\n\t\t\tthis.incBottom, this.decBottom, this.incLeft, this.decLeft);\n\t}\n\tgetSegments(count: number): PIXI.Point[] | PIXI.Point[][] {\n\t\tif (this.mode == ToolMode.NotPlaced) return [];\n\t\tthis.lastCount = count;\n\t\tconst bounds = this.bounds;\n\n\t\tconst width = bounds.maxX - bounds.minX;\n\t\tconst height = bounds.maxY - bounds.minY;\n\t\tconst points: PIXI.Point[][] = [];\n\t\t// top\n\t\tlet size = width / (count + this.topCount);\n\t\tfor (let c = 0; c < count + this.topCount; c++) {\n\t\t\tpoints.push([\n\t\t\t\tnew PIXI.Point(bounds.minX + (c * size), bounds.minY),\n\t\t\t\tnew PIXI.Point(bounds.minX + ((c + 1) * size), bounds.minY)\n\t\t\t]);\n\t\t}\n\t\t// right\n\t\tsize = height / (count + this.rightCount);\n\t\tfor (let c = 0; c < count + this.rightCount; c++) {\n\t\t\tpoints.push([\n\t\t\t\tnew PIXI.Point(bounds.maxX, bounds.minY + (c * size)),\n\t\t\t\tnew PIXI.Point(bounds.maxX, bounds.minY + ((c + 1) * size))\n\t\t\t]);\n\t\t}\n\t\t// bottom\n\t\tsize = width / (count + this.bottomCount);\n\t\tfor (let c = 0; c < count + this.bottomCount; c++) {\n\t\t\tpoints.push([\n\t\t\t\tnew PIXI.Point(bounds.maxX - (c * size), bounds.maxY),\n\t\t\t\tnew PIXI.Point(bounds.maxX - ((c + 1) * size), bounds.maxY)\n\t\t\t]);\n\t\t}\n\t\t// left\n\t\tsize = height / (count + this.leftCount);\n\t\tfor (let c = 0; c < count + this.leftCount; c++) {\n\t\t\tpoints.push([\n\t\t\t\tnew PIXI.Point(bounds.minX, bounds.maxY - (c * size)),\n\t\t\t\tnew PIXI.Point(bounds.minX, bounds.maxY - ((c + 1) * size))\n\t\t\t]);\n\t\t}\n\t\treturn (this.lastSegmentFetch = points);\n\t}\n\tcheckPointForDrag(point: PIXI.Point): InputHandler | null {\n\t\tif (this.mode == ToolMode.NotPlaced) {\n\t\t\tthis.setMode(ToolMode.Placing);\n\t\t\treturn new InitializerIH(this, () => this.setMode(ToolMode.Placed), () => this.setMode(ToolMode.NotPlaced));\n\t\t}\n\t\tif (pointNearPoint(point, this.lineA, BezierTool.HANDLE_RADIUS))\n\t\t\treturn new PointInputHandler(this, this.lineA, null, this.lineB);\n\t\telse if (pointNearPoint(point, this.lineB, BezierTool.HANDLE_RADIUS))\n\t\t\treturn new PointInputHandler(this, this.lineB, null, this.lineA);\n\t\telse if (this.rect.contains(point.x, point.y))\n\t\t\treturn new PointArrayInputHandler(this, point, this.handles);\n\t\treturn null;\n\t}\n\n\tcheckPointForClick(point: PIXI.Point): boolean {\n\t\tif (pointNearPoint(point, this.incTop.position, BezierTool.HANDLE_RADIUS * 2)) {\n\t\t\tthis.topCount = Math.clamped(this.topCount + 1, -64, 64);\n\t\t\treturn true;\n\t\t}\n\t\tif (pointNearPoint(point, this.decTop.position, BezierTool.HANDLE_RADIUS * 2)) {\n\t\t\tthis.topCount = Math.clamped(this.topCount - 1, -64, 64);\n\t\t\treturn true;\n\t\t}\n\t\tif (pointNearPoint(point, this.incRight.position, BezierTool.HANDLE_RADIUS * 2)) {\n\t\t\tthis.rightCount = Math.clamped(this.rightCount + 1, -64, 64);\n\t\t\treturn true;\n\t\t}\n\t\tif (pointNearPoint(point, this.decRight.position, BezierTool.HANDLE_RADIUS * 2)) {\n\t\t\tthis.rightCount = Math.clamped(this.rightCount - 1, -64, 64);\n\t\t\treturn true;\n\t\t}\n\t\tif (pointNearPoint(point, this.incBottom.position, BezierTool.HANDLE_RADIUS * 2)) {\n\t\t\tthis.bottomCount = Math.clamped(this.bottomCount + 1, -64, 64);\n\t\t\treturn true;\n\t\t}\n\t\tif (pointNearPoint(point, this.decBottom.position, BezierTool.HANDLE_RADIUS * 2)) {\n\t\t\tthis.bottomCount = Math.clamped(this.bottomCount - 1, -64, 64);\n\t\t\treturn true;\n\t\t}\n\t\tif (pointNearPoint(point, this.incLeft.position, BezierTool.HANDLE_RADIUS * 2)) {\n\t\t\tthis.leftCount = Math.clamped(this.leftCount + 1, -64, 64);\n\t\t\treturn true;\n\t\t}\n\t\tif (pointNearPoint(point, this.decLeft.position, BezierTool.HANDLE_RADIUS * 2)) {\n\t\t\tthis.leftCount = Math.clamped(this.leftCount - 1, -64, 64);\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tgetTools(): Record<string, CurvyWallControl> { return {}; }\n\tplaceTool(point: PIXI.Point, data: { l1: number[], l2: number[], t: number, r: number, b: number, l: number }) {\n\t\tthis.lineA.set(data.l1[0] + point.x, data.l1[1] + point.y);\n\t\tthis.lineB.set(data.l2[0] + point.x, data.l2[1] + point.y);\n\t\tthis.topCount = data.t;\n\t\tthis.rightCount = data.r;\n\t\tthis.bottomCount = data.b;\n\t\tthis.leftCount = data.l;\n\t\tthis.setMode(ToolMode.Placed);\n\t}\n\tgetData() {\n\t\tconst center = this.lineCenter;\n\t\treturn {\n\t\t\tl1: [this.lineA.x - center.x, this.lineA.y - center.y],\n\t\t\tl2: [this.lineB.x - center.x, this.lineB.y - center.y],\n\t\t\tt: this.topCount,\n\t\t\tr: this.rightCount,\n\t\t\tb: this.bottomCount,\n\t\t\tl: this.leftCount\n\t\t};\n\t}\n\tinitialPoints(): number[] { return [0, 0, 0, 0, 0, 0]; }\n}","import { CurvyWallControl } from '../CurvyWallsToolBar';\nimport { Bezier } from '../../libs/bezier';\nimport { BezierTool, ToolMode } from './BezierTool';\nimport { PointArrayInputHandler, InputHandler, PointInputHandler, InitializerInputHandler, MagnetPointInputHandler } from \"./ToolInputHandler\";\n\nconst pointNearPoint = BezierTool.pointNearPoint;\ndeclare type Point = PIXI.Point;\n\nclass InitializerIH extends InitializerInputHandler {\n\tprivate get cubicTool(): CubicTool { return this.tool as CubicTool; }\n\tconstructor(tool: CubicTool, success: () => void, fail: () => void) {\n\t\tsuper(tool, false, tool.lineA, tool.lineB, success, fail);\n\t}\n\tmove(origin: Point, destination: Point, event: PIXI.InteractionEvent): void {\n\t\tsuper.move(origin, destination, event);\n\t\tlet dx = this.tool.lineB.x - this.tool.lineA.x;\n\t\tlet dy = this.tool.lineB.y - this.tool.lineA.y;\n\t\tconst length = Math.sqrt((dx * dx) + (dy * dy));\n\t\tdx /= length;\n\t\tdy /= length;\n\t\tconst barLength = length * (2 / 3);\n\t\tthis.cubicTool.controlA.set(this.tool.lineA.x + (dy * barLength), this.tool.lineA.y + (-dx * barLength));\n\t\tthis.cubicTool.controlB.set(this.tool.lineB.x + (dy * barLength), this.tool.lineB.y + (-dx * barLength));\n\t}\n}\n\nexport default class CubicTool extends BezierTool {\n\tstatic lockHandles = true;\n\tprivate bezier: Bezier;\n\tlineA = new PIXI.Point();\n\tlineB = new PIXI.Point();\n\tcontrolA = new PIXI.Point();\n\tcontrolB = new PIXI.Point();\n\n\tget handles(): Point[] { return [this.lineA, this.controlA, this.controlB, this.lineB]; }\n\tget bounds(): PIXI.Bounds {\n\t\tconst b = new PIXI.Bounds();\n\t\tb.addPoint(this.lineA);\n\t\tb.addPoint(this.lineB);\n\t\tb.addPoint(this.controlA);\n\t\tb.addPoint(this.controlB);\n\t\treturn b;\n\t}\n\tget polygon(): PIXI.Polygon { return new PIXI.Polygon([this.lineA, this.lineB, this.controlA, this.controlB]); }\n\n\tconstructor(segments: number = 10) {\n\t\tsuper(segments);\n\t\tthis.bezier = new Bezier([0, 0, 0, 0, 0, 0, 0, 0]);\n\t}\n\tgetSegments(count: number): PIXI.Point[] | PIXI.Point[][] {\n\t\tif (this.mode == ToolMode.NotPlaced) return [];\n\t\tthis.bezier.points = this.handles;\n\t\tthis.bezier.update();\n\t\treturn (this.lastSegmentFetch = this.bezier.getLUT(count + 2).map((e: { x: number, y: number }) => new PIXI.Point(e.x, e.y)));\n\t}\n\tdrawHandles(context: PIXI.Graphics): void {\n\t\tif (this.mode == ToolMode.NotPlaced) return;\n\t\tthis.drawBoundingBox(context);\n\t\tcontext.beginFill(0xffaacc)\n\t\t\t.lineStyle(BezierTool.LINE_SIZE, 0xffaacc, 1, 0.5)\n\t\t\t.moveTo(this.lineA.x, this.lineA.y)\n\t\t\t.lineTo(this.controlA.x, this.controlA.y)\n\t\t\t.moveTo(this.lineB.x, this.lineB.y)\n\t\t\t.lineTo(this.controlB.x, this.controlB.y)\n\t\t\t.endFill();\n\t\tsuper.drawSegmentLabel(context);\n\t\tthis.drawHandle(context, 0xff4444, this.lineA);\n\t\tthis.drawHandle(context, 0xff4444, this.lineB);\n\t\tthis.drawHandle(context, 0xaaff44, this.controlA);\n\t\tthis.drawHandle(context, 0xaaff44, this.controlB);\n\t}\n\tcheckPointForDrag(point: Point): InputHandler | null {\n\t\tif (this.mode == ToolMode.NotPlaced) {\n\t\t\tthis.setMode(ToolMode.Placing);\n\t\t\treturn new InitializerIH(this, () => this.setMode(ToolMode.Placed), () => this.setMode(ToolMode.NotPlaced));\n\t\t}\n\t\tif (pointNearPoint(point, this.lineA, BezierTool.HANDLE_RADIUS))\n\t\t\treturn CubicTool.lockHandles\n\t\t\t\t? new MagnetPointInputHandler(this, this.lineA, this.controlA)\n\t\t\t\t: new PointInputHandler(this, this.lineA);\n\t\telse if (pointNearPoint(point, this.lineB, BezierTool.HANDLE_RADIUS))\n\t\t\treturn CubicTool.lockHandles\n\t\t\t\t? new MagnetPointInputHandler(this, this.lineB, this.controlB)\n\t\t\t\t: new PointInputHandler(this, this.lineB);\n\t\telse if (pointNearPoint(point, this.controlA, BezierTool.HANDLE_RADIUS))\n\t\t\treturn new PointInputHandler(this, this.controlA);\n\t\telse if (pointNearPoint(point, this.controlB, BezierTool.HANDLE_RADIUS))\n\t\t\treturn new PointInputHandler(this, this.controlB);\n\t\telse if (this.polygon.contains(point.x, point.y))\n\t\t\treturn new PointArrayInputHandler(this, point, this.handles);\n\t\treturn null;\n\t}\n\n\tgetTools(): Record<string, CurvyWallControl> {\n\t\treturn {\n\t\t\tcubiclock: {\n\t\t\t\ticon: 'fas fa-lock',\n\t\t\t\ttitle: 'df-curvy-walls.cubic_lock_handles',\n\t\t\t\ttoggleable: true,\n\t\t\t\tisActive: () => CubicTool.lockHandles,\n\t\t\t\tonClick: enabled => CubicTool.lockHandles = enabled\n\t\t\t}\n\t\t};\n\t}\n\tplaceTool(point: PIXI.Point, data: { l1: number[], l2: number[], c1: number[], c2: number[] }) {\n\t\tthis.lineA.set(data.l1[0] + point.x, data.l1[1] + point.y);\n\t\tthis.lineB.set(data.l2[0] + point.x, data.l2[1] + point.y);\n\t\tthis.controlA.set(data.c1[0] + point.x, data.c1[1] + point.y);\n\t\tthis.controlB.set(data.c2[0] + point.x, data.c2[1] + point.y);\n\t\tthis.setMode(ToolMode.Placed);\n\t}\n\tgetData() {\n\t\tconst center = this.lineCenter;\n\t\treturn {\n\t\t\tl1: [this.lineA.x - center.x, this.lineA.y - center.y],\n\t\t\tl2: [this.lineB.x - center.x, this.lineB.y - center.y],\n\t\t\tc1: [this.controlA.x - center.x, this.controlA.y - center.y],\n\t\t\tc2: [this.controlB.x - center.x, this.controlB.y - center.y]\n\t\t};\n\t}\n}","// math-inlining.\nconst { abs, cos, sin, acos, atan2, sqrt, pow } = Math;\n\n// cube root function yielding real roots\nfunction crt(v) {\n\treturn v < 0 ? -pow(-v, 1 / 3) : pow(v, 1 / 3);\n}\n\n// trig constants\nconst pi = Math.PI,\n\ttau = 2 * pi,\n\tquart = pi / 2,\n\t// float precision significant decimal\n\tepsilon = 0.000001,\n\t// extremas used in bbox calculation and similar algorithms\n\tnMax = Number.MAX_SAFE_INTEGER || 9007199254740991,\n\tnMin = Number.MIN_SAFE_INTEGER || -9007199254740991,\n\t// a zero coordinate, which is surprisingly useful\n\tZERO = { x: 0, y: 0, z: 0 };\n\n// Bezier utility functions\nconst utils = {\n\t// Legendre-Gauss abscissae with n=24 (x_i values, defined at i=n as the roots of the nth order Legendre polynomial Pn(x))\n\tTvalues: [\n\t\t-0.0640568928626056260850430826247450385909,\n\t\t0.0640568928626056260850430826247450385909,\n\t\t-0.1911188674736163091586398207570696318404,\n\t\t0.1911188674736163091586398207570696318404,\n\t\t-0.3150426796961633743867932913198102407864,\n\t\t0.3150426796961633743867932913198102407864,\n\t\t-0.4337935076260451384870842319133497124524,\n\t\t0.4337935076260451384870842319133497124524,\n\t\t-0.5454214713888395356583756172183723700107,\n\t\t0.5454214713888395356583756172183723700107,\n\t\t-0.6480936519369755692524957869107476266696,\n\t\t0.6480936519369755692524957869107476266696,\n\t\t-0.7401241915785543642438281030999784255232,\n\t\t0.7401241915785543642438281030999784255232,\n\t\t-0.8200019859739029219539498726697452080761,\n\t\t0.8200019859739029219539498726697452080761,\n\t\t-0.8864155270044010342131543419821967550873,\n\t\t0.8864155270044010342131543419821967550873,\n\t\t-0.9382745520027327585236490017087214496548,\n\t\t0.9382745520027327585236490017087214496548,\n\t\t-0.9747285559713094981983919930081690617411,\n\t\t0.9747285559713094981983919930081690617411,\n\t\t-0.9951872199970213601799974097007368118745,\n\t\t0.9951872199970213601799974097007368118745,\n\t],\n\n\t// Legendre-Gauss weights with n=24 (w_i values, defined by a function linked to in the Bezier primer article)\n\tCvalues: [\n\t\t0.1279381953467521569740561652246953718517,\n\t\t0.1279381953467521569740561652246953718517,\n\t\t0.1258374563468282961213753825111836887264,\n\t\t0.1258374563468282961213753825111836887264,\n\t\t0.121670472927803391204463153476262425607,\n\t\t0.121670472927803391204463153476262425607,\n\t\t0.1155056680537256013533444839067835598622,\n\t\t0.1155056680537256013533444839067835598622,\n\t\t0.1074442701159656347825773424466062227946,\n\t\t0.1074442701159656347825773424466062227946,\n\t\t0.0976186521041138882698806644642471544279,\n\t\t0.0976186521041138882698806644642471544279,\n\t\t0.086190161531953275917185202983742667185,\n\t\t0.086190161531953275917185202983742667185,\n\t\t0.0733464814110803057340336152531165181193,\n\t\t0.0733464814110803057340336152531165181193,\n\t\t0.0592985849154367807463677585001085845412,\n\t\t0.0592985849154367807463677585001085845412,\n\t\t0.0442774388174198061686027482113382288593,\n\t\t0.0442774388174198061686027482113382288593,\n\t\t0.0285313886289336631813078159518782864491,\n\t\t0.0285313886289336631813078159518782864491,\n\t\t0.0123412297999871995468056670700372915759,\n\t\t0.0123412297999871995468056670700372915759,\n\t],\n\n\tarcfn: function (t, derivativeFn) {\n\t\tconst d = derivativeFn(t);\n\t\tlet l = d.x * d.x + d.y * d.y;\n\t\tif (typeof d.z !== \"undefined\") {\n\t\t\tl += d.z * d.z;\n\t\t}\n\t\treturn sqrt(l);\n\t},\n\n\tcompute: function (t, points, _3d) {\n\t\t// shortcuts\n\t\tif (t === 0) {\n\t\t\tpoints[0].t = 0;\n\t\t\treturn points[0];\n\t\t}\n\n\t\tconst order = points.length - 1;\n\n\t\tif (t === 1) {\n\t\t\tpoints[order].t = 1;\n\t\t\treturn points[order];\n\t\t}\n\n\t\tconst mt = 1 - t;\n\t\tlet p = points;\n\n\t\t// constant?\n\t\tif (order === 0) {\n\t\t\tpoints[0].t = t;\n\t\t\treturn points[0];\n\t\t}\n\n\t\t// linear?\n\t\tif (order === 1) {\n\t\t\tconst ret = {\n\t\t\t\tx: mt * p[0].x + t * p[1].x,\n\t\t\t\ty: mt * p[0].y + t * p[1].y,\n\t\t\t\tt: t,\n\t\t\t};\n\t\t\tif (_3d) {\n\t\t\t\tret.z = mt * p[0].z + t * p[1].z;\n\t\t\t}\n\t\t\treturn ret;\n\t\t}\n\n\t\t// quadratic/cubic curve?\n\t\tif (order < 4) {\n\t\t\tlet mt2 = mt * mt,\n\t\t\t\tt2 = t * t,\n\t\t\t\ta,\n\t\t\t\tb,\n\t\t\t\tc,\n\t\t\t\td = 0;\n\t\t\tif (order === 2) {\n\t\t\t\tp = [p[0], p[1], p[2], ZERO];\n\t\t\t\ta = mt2;\n\t\t\t\tb = mt * t * 2;\n\t\t\t\tc = t2;\n\t\t\t} else if (order === 3) {\n\t\t\t\ta = mt2 * mt;\n\t\t\t\tb = mt2 * t * 3;\n\t\t\t\tc = mt * t2 * 3;\n\t\t\t\td = t * t2;\n\t\t\t}\n\t\t\tconst ret = {\n\t\t\t\tx: a * p[0].x + b * p[1].x + c * p[2].x + d * p[3].x,\n\t\t\t\ty: a * p[0].y + b * p[1].y + c * p[2].y + d * p[3].y,\n\t\t\t\tt: t,\n\t\t\t};\n\t\t\tif (_3d) {\n\t\t\t\tret.z = a * p[0].z + b * p[1].z + c * p[2].z + d * p[3].z;\n\t\t\t}\n\t\t\treturn ret;\n\t\t}\n\n\t\t// higher order curves: use de Casteljau's computation\n\t\tconst dCpts = JSON.parse(JSON.stringify(points));\n\t\twhile (dCpts.length > 1) {\n\t\t\tfor (let i = 0; i < dCpts.length - 1; i++) {\n\t\t\t\tdCpts[i] = {\n\t\t\t\t\tx: dCpts[i].x + (dCpts[i + 1].x - dCpts[i].x) * t,\n\t\t\t\t\ty: dCpts[i].y + (dCpts[i + 1].y - dCpts[i].y) * t,\n\t\t\t\t};\n\t\t\t\tif (typeof dCpts[i].z !== \"undefined\") {\n\t\t\t\t\tdCpts[i] = dCpts[i].z + (dCpts[i + 1].z - dCpts[i].z) * t;\n\t\t\t\t}\n\t\t\t}\n\t\t\tdCpts.splice(dCpts.length - 1, 1);\n\t\t}\n\t\tdCpts[0].t = t;\n\t\treturn dCpts[0];\n\t},\n\n\tcomputeWithRatios: function (t, points, ratios, _3d) {\n\t\tconst mt = 1 - t,\n\t\t\tr = ratios,\n\t\t\tp = points;\n\n\t\tlet f1 = r[0],\n\t\t\tf2 = r[1],\n\t\t\tf3 = r[2],\n\t\t\tf4 = r[3],\n\t\t\td;\n\n\t\t// spec for linear\n\t\tf1 *= mt;\n\t\tf2 *= t;\n\n\t\tif (p.length === 2) {\n\t\t\td = f1 + f2;\n\t\t\treturn {\n\t\t\t\tx: (f1 * p[0].x + f2 * p[1].x) / d,\n\t\t\t\ty: (f1 * p[0].y + f2 * p[1].y) / d,\n\t\t\t\tz: !_3d ? false : (f1 * p[0].z + f2 * p[1].z) / d,\n\t\t\t\tt: t,\n\t\t\t};\n\t\t}\n\n\t\t// upgrade to quadratic\n\t\tf1 *= mt;\n\t\tf2 *= 2 * mt;\n\t\tf3 *= t * t;\n\n\t\tif (p.length === 3) {\n\t\t\td = f1 + f2 + f3;\n\t\t\treturn {\n\t\t\t\tx: (f1 * p[0].x + f2 * p[1].x + f3 * p[2].x) / d,\n\t\t\t\ty: (f1 * p[0].y + f2 * p[1].y + f3 * p[2].y) / d,\n\t\t\t\tz: !_3d ? false : (f1 * p[0].z + f2 * p[1].z + f3 * p[2].z) / d,\n\t\t\t\tt: t,\n\t\t\t};\n\t\t}\n\n\t\t// upgrade to cubic\n\t\tf1 *= mt;\n\t\tf2 *= 1.5 * mt;\n\t\tf3 *= 3 * mt;\n\t\tf4 *= t * t * t;\n\n\t\tif (p.length === 4) {\n\t\t\td = f1 + f2 + f3 + f4;\n\t\t\treturn {\n\t\t\t\tx: (f1 * p[0].x + f2 * p[1].x + f3 * p[2].x + f4 * p[3].x) / d,\n\t\t\t\ty: (f1 * p[0].y + f2 * p[1].y + f3 * p[2].y + f4 * p[3].y) / d,\n\t\t\t\tz: !_3d\n\t\t\t\t\t? false\n\t\t\t\t\t: (f1 * p[0].z + f2 * p[1].z + f3 * p[2].z + f4 * p[3].z) / d,\n\t\t\t\tt: t,\n\t\t\t};\n\t\t}\n\t},\n\n\tderive: function (points, _3d) {\n\t\tconst dpoints = [];\n\t\tfor (let p = points, d = p.length, c = d - 1; d > 1; d--, c--) {\n\t\t\tconst list = [];\n\t\t\tfor (let j = 0, dpt; j < c; j++) {\n\t\t\t\tdpt = {\n\t\t\t\t\tx: c * (p[j + 1].x - p[j].x),\n\t\t\t\t\ty: c * (p[j + 1].y - p[j].y),\n\t\t\t\t};\n\t\t\t\tif (_3d) {\n\t\t\t\t\tdpt.z = c * (p[j + 1].z - p[j].z);\n\t\t\t\t}\n\t\t\t\tlist.push(dpt);\n\t\t\t}\n\t\t\tdpoints.push(list);\n\t\t\tp = list;\n\t\t}\n\t\treturn dpoints;\n\t},\n\n\tbetween: function (v, m, M) {\n\t\treturn (\n\t\t\t(m <= v && v <= M) ||\n\t\t\tutils.approximately(v, m) ||\n\t\t\tutils.approximately(v, M)\n\t\t);\n\t},\n\n\tapproximately: function (a, b, precision) {\n\t\treturn abs(a - b) <= (precision || epsilon);\n\t},\n\n\tlength: function (derivativeFn) {\n\t\tconst z = 0.5,\n\t\t\tlen = utils.Tvalues.length;\n\n\t\tlet sum = 0;\n\n\t\tfor (let i = 0, t; i < len; i++) {\n\t\t\tt = z * utils.Tvalues[i] + z;\n\t\t\tsum += utils.Cvalues[i] * utils.arcfn(t, derivativeFn);\n\t\t}\n\t\treturn z * sum;\n\t},\n\n\tmap: function (v, ds, de, ts, te) {\n\t\tconst d1 = de - ds,\n\t\t\td2 = te - ts,\n\t\t\tv2 = v - ds,\n\t\t\tr = v2 / d1;\n\t\treturn ts + d2 * r;\n\t},\n\n\tlerp: function (r, v1, v2) {\n\t\tconst ret = {\n\t\t\tx: v1.x + r * (v2.x - v1.x),\n\t\t\ty: v1.y + r * (v2.y - v1.y),\n\t\t};\n\t\tif (!!v1.z && !!v2.z) {\n\t\t\tret.z = v1.z + r * (v2.z - v1.z);\n\t\t}\n\t\treturn ret;\n\t},\n\n\tpointToString: function (p) {\n\t\tlet s = p.x + \"/\" + p.y;\n\t\tif (typeof p.z !== \"undefined\") {\n\t\t\ts += \"/\" + p.z;\n\t\t}\n\t\treturn s;\n\t},\n\n\tpointsToString: function (points) {\n\t\treturn \"[\" + points.map(utils.pointToString).join(\", \") + \"]\";\n\t},\n\n\tcopy: function (obj) {\n\t\treturn JSON.parse(JSON.stringify(obj));\n\t},\n\n\tangle: function (o, v1, v2) {\n\t\tconst dx1 = v1.x - o.x,\n\t\t\tdy1 = v1.y - o.y,\n\t\t\tdx2 = v2.x - o.x,\n\t\t\tdy2 = v2.y - o.y,\n\t\t\tcross = dx1 * dy2 - dy1 * dx2,\n\t\t\tdot = dx1 * dx2 + dy1 * dy2;\n\t\treturn atan2(cross, dot);\n\t},\n\n\t// round as string, to avoid rounding errors\n\tround: function (v, d) {\n\t\tconst s = \"\" + v;\n\t\tconst pos = s.indexOf(\".\");\n\t\treturn parseFloat(s.substring(0, pos + 1 + d));\n\t},\n\n\tdist: function (p1, p2) {\n\t\tconst dx = p1.x - p2.x,\n\t\t\tdy = p1.y - p2.y;\n\t\treturn sqrt(dx * dx + dy * dy);\n\t},\n\n\tclosest: function (LUT, point) {\n\t\tlet mdist = pow(2, 63),\n\t\t\tmpos,\n\t\t\td;\n\t\tLUT.forEach(function (p, idx) {\n\t\t\td = utils.dist(point, p);\n\t\t\tif (d < mdist) {\n\t\t\t\tmdist = d;\n\t\t\t\tmpos = idx;\n\t\t\t}\n\t\t});\n\t\treturn { mdist: mdist, mpos: mpos };\n\t},\n\n\tabcratio: function (t, n) {\n\t\t// see ratio(t) note on http://pomax.github.io/bezierinfo/#abc\n\t\tif (n !== 2 && n !== 3) {\n\t\t\treturn false;\n\t\t}\n\t\tif (typeof t === \"undefined\") {\n\t\t\tt = 0.5;\n\t\t} else if (t === 0 || t === 1) {\n\t\t\treturn t;\n\t\t}\n\t\tconst bottom = pow(t, n) + pow(1 - t, n),\n\t\t\ttop = bottom - 1;\n\t\treturn abs(top / bottom);\n\t},\n\n\tprojectionratio: function (t, n) {\n\t\t// see u(t) note on http://pomax.github.io/bezierinfo/#abc\n\t\tif (n !== 2 && n !== 3) {\n\t\t\treturn false;\n\t\t}\n\t\tif (typeof t === \"undefined\") {\n\t\t\tt = 0.5;\n\t\t} else if (t === 0 || t === 1) {\n\t\t\treturn t;\n\t\t}\n\t\tconst top = pow(1 - t, n),\n\t\t\tbottom = pow(t, n) + top;\n\t\treturn top / bottom;\n\t},\n\n\tlli8: function (x1, y1, x2, y2, x3, y3, x4, y4) {\n\t\tconst nx =\n\t\t\t(x1 * y2 - y1 * x2) * (x3 - x4) - (x1 - x2) * (x3 * y4 - y3 * x4),\n\t\t\tny = (x1 * y2 - y1 * x2) * (y3 - y4) - (y1 - y2) * (x3 * y4 - y3 * x4),\n\t\t\td = (x1 - x2) * (y3 - y4) - (y1 - y2) * (x3 - x4);\n\t\tif (d == 0) {\n\t\t\treturn false;\n\t\t}\n\t\treturn { x: nx / d, y: ny / d };\n\t},\n\n\tlli4: function (p1, p2, p3, p4) {\n\t\tconst x1 = p1.x,\n\t\t\ty1 = p1.y,\n\t\t\tx2 = p2.x,\n\t\t\ty2 = p2.y,\n\t\t\tx3 = p3.x,\n\t\t\ty3 = p3.y,\n\t\t\tx4 = p4.x,\n\t\t\ty4 = p4.y;\n\t\treturn utils.lli8(x1, y1, x2, y2, x3, y3, x4, y4);\n\t},\n\n\tlli: function (v1, v2) {\n\t\treturn utils.lli4(v1, v1.c, v2, v2.c);\n\t},\n\n\tmakeline: function (p1, p2) {\n\t\tconst x1 = p1.x,\n\t\t\ty1 = p1.y,\n\t\t\tx2 = p2.x,\n\t\t\ty2 = p2.y,\n\t\t\tdx = (x2 - x1) / 3,\n\t\t\tdy = (y2 - y1) / 3;\n\t\treturn new Bezier(\n\t\t\tx1,\n\t\t\ty1,\n\t\t\tx1 + dx,\n\t\t\ty1 + dy,\n\t\t\tx1 + 2 * dx,\n\t\t\ty1 + 2 * dy,\n\t\t\tx2,\n\t\t\ty2\n\t\t);\n\t},\n\n\tfindbbox: function (sections) {\n\t\tlet mx = nMax,\n\t\t\tmy = nMax,\n\t\t\tMX = nMin,\n\t\t\tMY = nMin;\n\t\tsections.forEach(function (s) {\n\t\t\tconst bbox = s.bbox();\n\t\t\tif (mx > bbox.x.min) mx = bbox.x.min;\n\t\t\tif (my > bbox.y.min) my = bbox.y.min;\n\t\t\tif (MX < bbox.x.max) MX = bbox.x.max;\n\t\t\tif (MY < bbox.y.max) MY = bbox.y.max;\n\t\t});\n\t\treturn {\n\t\t\tx: { min: mx, mid: (mx + MX) / 2, max: MX, size: MX - mx },\n\t\t\ty: { min: my, mid: (my + MY) / 2, max: MY, size: MY - my },\n\t\t};\n\t},\n\n\tshapeintersections: function (\n\t\ts1,\n\t\tbbox1,\n\t\ts2,\n\t\tbbox2,\n\t\tcurveIntersectionThreshold\n\t) {\n\t\tif (!utils.bboxoverlap(bbox1, bbox2)) return [];\n\t\tconst intersections = [];\n\t\tconst a1 = [s1.startcap, s1.forward, s1.back, s1.endcap];\n\t\tconst a2 = [s2.startcap, s2.forward, s2.back, s2.endcap];\n\t\ta1.forEach(function (l1) {\n\t\t\tif (l1.virtual) return;\n\t\t\ta2.forEach(function (l2) {\n\t\t\t\tif (l2.virtual) return;\n\t\t\t\tconst iss = l1.intersects(l2, curveIntersectionThreshold);\n\t\t\t\tif (iss.length > 0) {\n\t\t\t\t\tiss.c1 = l1;\n\t\t\t\t\tiss.c2 = l2;\n\t\t\t\t\tiss.s1 = s1;\n\t\t\t\t\tiss.s2 = s2;\n\t\t\t\t\tintersections.push(iss);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t\treturn intersections;\n\t},\n\n\tmakeshape: function (forward, back, curveIntersectionThreshold) {\n\t\tconst bpl = back.points.length;\n\t\tconst fpl = forward.points.length;\n\t\tconst start = utils.makeline(back.points[bpl - 1], forward.points[0]);\n\t\tconst end = utils.makeline(forward.points[fpl - 1], back.points[0]);\n\t\tconst shape = {\n\t\t\tstartcap: start,\n\t\t\tforward: forward,\n\t\t\tback: back,\n\t\t\tendcap: end,\n\t\t\tbbox: utils.findbbox([start, forward, back, end]),\n\t\t};\n\t\tshape.intersections = function (s2) {\n\t\t\treturn utils.shapeintersections(\n\t\t\t\tshape,\n\t\t\t\tshape.bbox,\n\t\t\t\ts2,\n\t\t\t\ts2.bbox,\n\t\t\t\tcurveIntersectionThreshold\n\t\t\t);\n\t\t};\n\t\treturn shape;\n\t},\n\n\tgetminmax: function (curve, d, list) {\n\t\tif (!list) return { min: 0, max: 0 };\n\t\tlet min = nMax,\n\t\t\tmax = nMin,\n\t\t\tt,\n\t\t\tc;\n\t\tif (list.indexOf(0) === -1) {\n\t\t\tlist = [0].concat(list);\n\t\t}\n\t\tif (list.indexOf(1) === -1) {\n\t\t\tlist.push(1);\n\t\t}\n\t\tfor (let i = 0, len = list.length; i < len; i++) {\n\t\t\tt = list[i];\n\t\t\tc = curve.get(t);\n\t\t\tif (c[d] < min) {\n\t\t\t\tmin = c[d];\n\t\t\t}\n\t\t\tif (c[d] > max) {\n\t\t\t\tmax = c[d];\n\t\t\t}\n\t\t}\n\t\treturn { min: min, mid: (min + max) / 2, max: max, size: max - min };\n\t},\n\n\talign: function (points, line) {\n\t\tconst tx = line.p1.x,\n\t\t\tty = line.p1.y,\n\t\t\ta = -atan2(line.p2.y - ty, line.p2.x - tx),\n\t\t\td = function (v) {\n\t\t\t\treturn {\n\t\t\t\t\tx: (v.x - tx) * cos(a) - (v.y - ty) * sin(a),\n\t\t\t\t\ty: (v.x - tx) * sin(a) + (v.y - ty) * cos(a),\n\t\t\t\t};\n\t\t\t};\n\t\treturn points.map(d);\n\t},\n\n\troots: function (points, line) {\n\t\tline = line || { p1: { x: 0, y: 0 }, p2: { x: 1, y: 0 } };\n\n\t\tconst order = points.length - 1;\n\t\tconst aligned = utils.align(points, line);\n\t\tconst reduce = function (t) {\n\t\t\treturn 0 <= t && t <= 1;\n\t\t};\n\n\t\tif (order === 2) {\n\t\t\tconst a = aligned[0].y,\n\t\t\t\tb = aligned[1].y,\n\t\t\t\tc = aligned[2].y,\n\t\t\t\td = a - 2 * b + c;\n\t\t\tif (d !== 0) {\n\t\t\t\tconst m1 = -sqrt(b * b - a * c),\n\t\t\t\t\tm2 = -a + b,\n\t\t\t\t\tv1 = -(m1 + m2) / d,\n\t\t\t\t\tv2 = -(-m1 + m2) / d;\n\t\t\t\treturn [v1, v2].filter(reduce);\n\t\t\t} else if (b !== c && d === 0) {\n\t\t\t\treturn [(2 * b - c) / (2 * b - 2 * c)].filter(reduce);\n\t\t\t}\n\t\t\treturn [];\n\t\t}\n\n\t\t// see http://www.trans4mind.com/personal_development/mathematics/polynomials/cubicAlgebra.htm\n\t\tconst pa = aligned[0].y,\n\t\t\tpb = aligned[1].y,\n\t\t\tpc = aligned[2].y,\n\t\t\tpd = aligned[3].y;\n\n\t\tlet d = -pa + 3 * pb - 3 * pc + pd,\n\t\t\ta = 3 * pa - 6 * pb + 3 * pc,\n\t\t\tb = -3 * pa + 3 * pb,\n\t\t\tc = pa;\n\n\t\tif (utils.approximately(d, 0)) {\n\t\t\t// this is not a cubic curve.\n\t\t\tif (utils.approximately(a, 0)) {\n\t\t\t\t// in fact, this is not a quadratic curve either.\n\t\t\t\tif (utils.approximately(b, 0)) {\n\t\t\t\t\t// in fact in fact, there are no solutions.\n\t\t\t\t\treturn [];\n\t\t\t\t}\n\t\t\t\t// linear solution:\n\t\t\t\treturn [-c / b].filter(reduce);\n\t\t\t}\n\t\t\t// quadratic solution:\n\t\t\tconst q = sqrt(b * b - 4 * a * c),\n\t\t\t\ta2 = 2 * a;\n\t\t\treturn [(q - b) / a2, (-b - q) / a2].filter(reduce);\n\t\t}\n\n\t\t// at this point, we know we need a cubic solution:\n\n\t\ta /= d;\n\t\tb /= d;\n\t\tc /= d;\n\n\t\tconst p = (3 * b - a * a) / 3,\n\t\t\tp3 = p / 3,\n\t\t\tq = (2 * a * a * a - 9 * a * b + 27 * c) / 27,\n\t\t\tq2 = q / 2,\n\t\t\tdiscriminant = q2 * q2 + p3 * p3 * p3;\n\n\t\tlet u1, v1, x1, x2, x3;\n\t\tif (discriminant < 0) {\n\t\t\tconst mp3 = -p / 3,\n\t\t\t\tmp33 = mp3 * mp3 * mp3,\n\t\t\t\tr = sqrt(mp33),\n\t\t\t\tt = -q / (2 * r),\n\t\t\t\tcosphi = t < -1 ? -1 : t > 1 ? 1 : t,\n\t\t\t\tphi = acos(cosphi),\n\t\t\t\tcrtr = crt(r),\n\t\t\t\tt1 = 2 * crtr;\n\t\t\tx1 = t1 * cos(phi / 3) - a / 3;\n\t\t\tx2 = t1 * cos((phi + tau) / 3) - a / 3;\n\t\t\tx3 = t1 * cos((phi + 2 * tau) / 3) - a / 3;\n\t\t\treturn [x1, x2, x3].filter(reduce);\n\t\t} else if (discriminant === 0) {\n\t\t\tu1 = q2 < 0 ? crt(-q2) : -crt(q2);\n\t\t\tx1 = 2 * u1 - a / 3;\n\t\t\tx2 = -u1 - a / 3;\n\t\t\treturn [x1, x2].filter(reduce);\n\t\t} else {\n\t\t\tconst sd = sqrt(discriminant);\n\t\t\tu1 = crt(-q2 + sd);\n\t\t\tv1 = crt(q2 + sd);\n\t\t\treturn [u1 - v1 - a / 3].filter(reduce);\n\t\t}\n\t},\n\n\tdroots: function (p) {\n\t\t// quadratic roots are easy\n\t\tif (p.length === 3) {\n\t\t\tconst a = p[0],\n\t\t\t\tb = p[1],\n\t\t\t\tc = p[2],\n\t\t\t\td = a - 2 * b + c;\n\t\t\tif (d !== 0) {\n\t\t\t\tconst m1 = -sqrt(b * b - a * c),\n\t\t\t\t\tm2 = -a + b,\n\t\t\t\t\tv1 = -(m1 + m2) / d,\n\t\t\t\t\tv2 = -(-m1 + m2) / d;\n\t\t\t\treturn [v1, v2];\n\t\t\t} else if (b !== c && d === 0) {\n\t\t\t\treturn [(2 * b - c) / (2 * (b - c))];\n\t\t\t}\n\t\t\treturn [];\n\t\t}\n\n\t\t// linear roots are even easier\n\t\tif (p.length === 2) {\n\t\t\tconst a = p[0],\n\t\t\t\tb = p[1];\n\t\t\tif (a !== b) {\n\t\t\t\treturn [a / (a - b)];\n\t\t\t}\n\t\t\treturn [];\n\t\t}\n\n\t\treturn [];\n\t},\n\n\tcurvature: function (t, d1, d2, _3d, kOnly) {\n\t\tlet num,\n\t\t\tdnm,\n\t\t\tadk,\n\t\t\tdk,\n\t\t\tk = 0,\n\t\t\tr = 0;\n\n\t\t//\n\t\t// We're using the following formula for curvature:\n\t\t//\n\t\t//              x'y\" - y'x\"\n\t\t//   k(t) = ------------------\n\t\t//           (x' + y')^(3/2)\n\t\t//\n\t\t// from https://en.wikipedia.org/wiki/Radius_of_curvature#Definition\n\t\t//\n\t\t// With it corresponding 3D counterpart:\n\t\t//\n\t\t//          sqrt( (y'z\" - y\"z') + (z'x\" - z\"x') + (x'y\" - x\"y'))\n\t\t//   k(t) = -------------------------------------------------------\n\t\t//                     (x' + y' + z')^(3/2)\n\t\t//\n\n\t\tconst d = utils.compute(t, d1);\n\t\tconst dd = utils.compute(t, d2);\n\t\tconst qdsum = d.x * d.x + d.y * d.y;\n\n\t\tif (_3d) {\n\t\t\tnum = sqrt(\n\t\t\t\tpow(d.y * dd.z - dd.y * d.z, 2) +\n\t\t\t\tpow(d.z * dd.x - dd.z * d.x, 2) +\n\t\t\t\tpow(d.x * dd.y - dd.x * d.y, 2)\n\t\t\t);\n\t\t\tdnm = pow(qdsum + d.z * d.z, 3 / 2);\n\t\t} else {\n\t\t\tnum = d.x * dd.y - d.y * dd.x;\n\t\t\tdnm = pow(qdsum, 3 / 2);\n\t\t}\n\n\t\tif (num === 0 || dnm === 0) {\n\t\t\treturn { k: 0, r: 0 };\n\t\t}\n\n\t\tk = num / dnm;\n\t\tr = dnm / num;\n\n\t\t// We're also computing the derivative of kappa, because\n\t\t// there is value in knowing the rate of change for the\n\t\t// curvature along the curve. And we're just going to\n\t\t// ballpark it based on an epsilon.\n\t\tif (!kOnly) {\n\t\t\t// compute k'(t) based on the interval before, and after it,\n\t\t\t// to at least try to not introduce forward/backward pass bias.\n\t\t\tconst pk = utils.curvature(t - 0.001, d1, d2, _3d, true).k;\n\t\t\tconst nk = utils.curvature(t + 0.001, d1, d2, _3d, true).k;\n\t\t\tdk = (nk - k + (k - pk)) / 2;\n\t\t\tadk = (abs(nk - k) + abs(k - pk)) / 2;\n\t\t}\n\n\t\treturn { k: k, r: r, dk: dk, adk: adk };\n\t},\n\n\tinflections: function (points) {\n\t\tif (points.length < 4) return [];\n\n\t\t// FIXME: TODO: add in inflection abstraction for quartic+ curves?\n\n\t\tconst p = utils.align(points, { p1: points[0], p2: points.slice(-1)[0] }),\n\t\t\ta = p[2].x * p[1].y,\n\t\t\tb = p[3].x * p[1].y,\n\t\t\tc = p[1].x * p[2].y,\n\t\t\td = p[3].x * p[2].y,\n\t\t\tv1 = 18 * (-3 * a + 2 * b + 3 * c - d),\n\t\t\tv2 = 18 * (3 * a - b - 3 * c),\n\t\t\tv3 = 18 * (c - a);\n\n\t\tif (utils.approximately(v1, 0)) {\n\t\t\tif (!utils.approximately(v2, 0)) {\n\t\t\t\tlet t = -v3 / v2;\n\t\t\t\tif (0 <= t && t <= 1) return [t];\n\t\t\t}\n\t\t\treturn [];\n\t\t}\n\n\t\tconst trm = v2 * v2 - 4 * v1 * v3,\n\t\t\tsq = Math.sqrt(trm),\n\t\t\td2 = 2 * v1;\n\n\t\tif (utils.approximately(d2, 0)) return [];\n\n\t\treturn [(sq - v2) / d2, -(v2 + sq) / d2].filter(function (r) {\n\t\t\treturn 0 <= r && r <= 1;\n\t\t});\n\t},\n\n\tbboxoverlap: function (b1, b2) {\n\t\tconst dims = [\"x\", \"y\"],\n\t\t\tlen = dims.length;\n\n\t\tfor (let i = 0, dim, l, t, d; i < len; i++) {\n\t\t\tdim = dims[i];\n\t\t\tl = b1[dim].mid;\n\t\t\tt = b2[dim].mid;\n\t\t\td = (b1[dim].size + b2[dim].size) / 2;\n\t\t\tif (abs(l - t) >= d) return false;\n\t\t}\n\t\treturn true;\n\t},\n\n\texpandbox: function (bbox, _bbox) {\n\t\tif (_bbox.x.min < bbox.x.min) {\n\t\t\tbbox.x.min = _bbox.x.min;\n\t\t}\n\t\tif (_bbox.y.min < bbox.y.min) {\n\t\t\tbbox.y.min = _bbox.y.min;\n\t\t}\n\t\tif (_bbox.z && _bbox.z.min < bbox.z.min) {\n\t\t\tbbox.z.min = _bbox.z.min;\n\t\t}\n\t\tif (_bbox.x.max > bbox.x.max) {\n\t\t\tbbox.x.max = _bbox.x.max;\n\t\t}\n\t\tif (_bbox.y.max > bbox.y.max) {\n\t\t\tbbox.y.max = _bbox.y.max;\n\t\t}\n\t\tif (_bbox.z && _bbox.z.max > bbox.z.max) {\n\t\t\tbbox.z.max = _bbox.z.max;\n\t\t}\n\t\tbbox.x.mid = (bbox.x.min + bbox.x.max) / 2;\n\t\tbbox.y.mid = (bbox.y.min + bbox.y.max) / 2;\n\t\tif (bbox.z) {\n\t\t\tbbox.z.mid = (bbox.z.min + bbox.z.max) / 2;\n\t\t}\n\t\tbbox.x.size = bbox.x.max - bbox.x.min;\n\t\tbbox.y.size = bbox.y.max - bbox.y.min;\n\t\tif (bbox.z) {\n\t\t\tbbox.z.size = bbox.z.max - bbox.z.min;\n\t\t}\n\t},\n\n\tpairiteration: function (c1, c2, curveIntersectionThreshold) {\n\t\tconst c1b = c1.bbox(),\n\t\t\tc2b = c2.bbox(),\n\t\t\tr = 100000,\n\t\t\tthreshold = curveIntersectionThreshold || 0.5;\n\n\t\tif (\n\t\t\tc1b.x.size + c1b.y.size < threshold &&\n\t\t\tc2b.x.size + c2b.y.size < threshold\n\t\t) {\n\t\t\treturn [\n\t\t\t\t(((r * (c1._t1 + c1._t2)) / 2) | 0) / r +\n\t\t\t\t\"/\" +\n\t\t\t\t(((r * (c2._t1 + c2._t2)) / 2) | 0) / r,\n\t\t\t];\n\t\t}\n\n\t\tlet cc1 = c1.split(0.5),\n\t\t\tcc2 = c2.split(0.5),\n\t\t\tpairs = [\n\t\t\t\t{ left: cc1.left, right: cc2.left },\n\t\t\t\t{ left: cc1.left, right: cc2.right },\n\t\t\t\t{ left: cc1.right, right: cc2.right },\n\t\t\t\t{ left: cc1.right, right: cc2.left },\n\t\t\t];\n\n\t\tpairs = pairs.filter(function (pair) {\n\t\t\treturn utils.bboxoverlap(pair.left.bbox(), pair.right.bbox());\n\t\t});\n\n\t\tlet results = [];\n\n\t\tif (pairs.length === 0) return results;\n\n\t\tpairs.forEach(function (pair) {\n\t\t\tresults = results.concat(\n\t\t\t\tutils.pairiteration(pair.left, pair.right, threshold)\n\t\t\t);\n\t\t});\n\n\t\tresults = results.filter(function (v, i) {\n\t\t\treturn results.indexOf(v) === i;\n\t\t});\n\n\t\treturn results;\n\t},\n\n\tgetccenter: function (p1, p2, p3) {\n\t\tconst dx1 = p2.x - p1.x,\n\t\t\tdy1 = p2.y - p1.y,\n\t\t\tdx2 = p3.x - p2.x,\n\t\t\tdy2 = p3.y - p2.y,\n\t\t\tdx1p = dx1 * cos(quart) - dy1 * sin(quart),\n\t\t\tdy1p = dx1 * sin(quart) + dy1 * cos(quart),\n\t\t\tdx2p = dx2 * cos(quart) - dy2 * sin(quart),\n\t\t\tdy2p = dx2 * sin(quart) + dy2 * cos(quart),\n\t\t\t// chord midpoints\n\t\t\tmx1 = (p1.x + p2.x) / 2,\n\t\t\tmy1 = (p1.y + p2.y) / 2,\n\t\t\tmx2 = (p2.x + p3.x) / 2,\n\t\t\tmy2 = (p2.y + p3.y) / 2,\n\t\t\t// midpoint offsets\n\t\t\tmx1n = mx1 + dx1p,\n\t\t\tmy1n = my1 + dy1p,\n\t\t\tmx2n = mx2 + dx2p,\n\t\t\tmy2n = my2 + dy2p,\n\t\t\t// intersection of these lines:\n\t\t\tarc = utils.lli8(mx1, my1, mx1n, my1n, mx2, my2, mx2n, my2n),\n\t\t\tr = utils.dist(arc, p1);\n\n\t\t// arc start/end values, over mid point:\n\t\tlet s = atan2(p1.y - arc.y, p1.x - arc.x),\n\t\t\tm = atan2(p2.y - arc.y, p2.x - arc.x),\n\t\t\te = atan2(p3.y - arc.y, p3.x - arc.x),\n\t\t\t_;\n\n\t\t// determine arc direction (cw/ccw correction)\n\t\tif (s < e) {\n\t\t\t// if s<m<e, arc(s, e)\n\t\t\t// if m<s<e, arc(e, s + tau)\n\t\t\t// if s<e<m, arc(e, s + tau)\n\t\t\tif (s > m || m > e) {\n\t\t\t\ts += tau;\n\t\t\t}\n\t\t\tif (s > e) {\n\t\t\t\t_ = e;\n\t\t\t\te = s;\n\t\t\t\ts = _;\n\t\t\t}\n\t\t} else {\n\t\t\t// if e<m<s, arc(e, s)\n\t\t\t// if m<e<s, arc(s, e + tau)\n\t\t\t// if e<s<m, arc(s, e + tau)\n\t\t\tif (e < m && m < s) {\n\t\t\t\t_ = e;\n\t\t\t\te = s;\n\t\t\t\ts = _;\n\t\t\t} else {\n\t\t\t\te += tau;\n\t\t\t}\n\t\t}\n\t\t// assign and done.\n\t\tarc.s = s;\n\t\tarc.e = e;\n\t\tarc.r = r;\n\t\treturn arc;\n\t},\n\n\tnumberSort: function (a, b) {\n\t\treturn a - b;\n\t},\n};\n\n/**\n * Poly Bezier\n * @param {[type]} curves [description]\n */\nclass PolyBezier {\n\tconstructor(curves) {\n\t\tthis.curves = [];\n\t\tthis._3d = false;\n\t\tif (!!curves) {\n\t\t\tthis.curves = curves;\n\t\t\tthis._3d = this.curves[0]._3d;\n\t\t}\n\t}\n\n\tvalueOf() {\n\t\treturn this.toString();\n\t}\n\n\ttoString() {\n\t\treturn (\n\t\t\t\"[\" +\n\t\t\tthis.curves\n\t\t\t\t.map(function (curve) {\n\t\t\t\t\treturn utils.pointsToString(curve.points);\n\t\t\t\t})\n\t\t\t\t.join(\", \") +\n\t\t\t\"]\"\n\t\t);\n\t}\n\n\taddCurve(curve) {\n\t\tthis.curves.push(curve);\n\t\tthis._3d = this._3d || curve._3d;\n\t}\n\n\tlength() {\n\t\treturn this.curves\n\t\t\t.map(function (v) {\n\t\t\t\treturn v.length();\n\t\t\t})\n\t\t\t.reduce(function (a, b) {\n\t\t\t\treturn a + b;\n\t\t\t});\n\t}\n\n\tcurve(idx) {\n\t\treturn this.curves[idx];\n\t}\n\n\tbbox() {\n\t\tconst c = this.curves;\n\t\tvar bbox = c[0].bbox();\n\t\tfor (var i = 1; i < c.length; i++) {\n\t\t\tutils.expandbox(bbox, c[i].bbox());\n\t\t}\n\t\treturn bbox;\n\t}\n\n\toffset(d) {\n\t\tconst offset = [];\n\t\tthis.curves.forEach(function (v) {\n\t\t\toffset.push(...v.offset(d));\n\t\t});\n\t\treturn new PolyBezier(offset);\n\t}\n}\n\n/**\n  A javascript Bezier curve library by Pomax.\n\n  Based on http://pomax.github.io/bezierinfo\n\n  This code is MIT licensed.\n**/\n\n// math-inlining.\nconst { abs: abs$1, min, max, cos: cos$1, sin: sin$1, acos: acos$1, sqrt: sqrt$1 } = Math;\nconst pi$1 = Math.PI;\n\n/**\n * Bezier curve constructor.\n *\n * ...docs pending...\n */\nclass Bezier {\n\tconstructor(coords) {\n\t\tlet args =\n\t\t\tcoords && coords.forEach ? coords : Array.from(arguments).slice();\n\t\tlet coordlen = false;\n\n\t\tif (typeof args[0] === \"object\") {\n\t\t\tcoordlen = args.length;\n\t\t\tconst newargs = [];\n\t\t\targs.forEach(function (point) {\n\t\t\t\t[\"x\", \"y\", \"z\"].forEach(function (d) {\n\t\t\t\t\tif (typeof point[d] !== \"undefined\") {\n\t\t\t\t\t\tnewargs.push(point[d]);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t\targs = newargs;\n\t\t}\n\n\t\tlet higher = false;\n\t\tconst len = args.length;\n\n\t\tif (coordlen) {\n\t\t\tif (coordlen > 4) {\n\t\t\t\tif (arguments.length !== 1) {\n\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t\"Only new Bezier(point[]) is accepted for 4th and higher order curves\"\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\thigher = true;\n\t\t\t}\n\t\t} else {\n\t\t\tif (len !== 6 && len !== 8 && len !== 9 && len !== 12) {\n\t\t\t\tif (arguments.length !== 1) {\n\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t\"Only new Bezier(point[]) is accepted for 4th and higher order curves\"\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst _3d = (this._3d =\n\t\t\t(!higher && (len === 9 || len === 12)) ||\n\t\t\t(coords && coords[0] && typeof coords[0].z !== \"undefined\"));\n\n\t\tconst points = (this.points = []);\n\t\tfor (let idx = 0, step = _3d ? 3 : 2; idx < len; idx += step) {\n\t\t\tvar point = {\n\t\t\t\tx: args[idx],\n\t\t\t\ty: args[idx + 1],\n\t\t\t};\n\t\t\tif (_3d) {\n\t\t\t\tpoint.z = args[idx + 2];\n\t\t\t}\n\t\t\tpoints.push(point);\n\t\t}\n\t\tconst order = (this.order = points.length - 1);\n\n\t\tconst dims = (this.dims = [\"x\", \"y\"]);\n\t\tif (_3d) dims.push(\"z\");\n\t\tthis.dimlen = dims.length;\n\n\t\tconst aligned = utils.align(points, { p1: points[0], p2: points[order] });\n\t\tthis._linear = !aligned.some((p) => abs$1(p.y) > 0.0001);\n\n\t\tthis._lut = [];\n\n\t\tthis._t1 = 0;\n\t\tthis._t2 = 1;\n\t\tthis.update();\n\t}\n\n\tstatic quadraticFromPoints(p1, p2, p3, t) {\n\t\tif (typeof t === \"undefined\") {\n\t\t\tt = 0.5;\n\t\t}\n\t\t// shortcuts, although they're really dumb\n\t\tif (t === 0) {\n\t\t\treturn new Bezier(p2, p2, p3);\n\t\t}\n\t\tif (t === 1) {\n\t\t\treturn new Bezier(p1, p2, p2);\n\t\t}\n\t\t// real fitting.\n\t\tconst abc = Bezier.getABC(2, p1, p2, p3, t);\n\t\treturn new Bezier(p1, abc.A, p3);\n\t}\n\n\tstatic cubicFromPoints(S, B, E, t, d1) {\n\t\tif (typeof t === \"undefined\") {\n\t\t\tt = 0.5;\n\t\t}\n\t\tconst abc = Bezier.getABC(3, S, B, E, t);\n\t\tif (typeof d1 === \"undefined\") {\n\t\t\td1 = utils.dist(B, abc.C);\n\t\t}\n\t\tconst d2 = (d1 * (1 - t)) / t;\n\n\t\tconst selen = utils.dist(S, E),\n\t\t\tlx = (E.x - S.x) / selen,\n\t\t\tly = (E.y - S.y) / selen,\n\t\t\tbx1 = d1 * lx,\n\t\t\tby1 = d1 * ly,\n\t\t\tbx2 = d2 * lx,\n\t\t\tby2 = d2 * ly;\n\t\t// derivation of new hull coordinates\n\t\tconst e1 = { x: B.x - bx1, y: B.y - by1 },\n\t\t\te2 = { x: B.x + bx2, y: B.y + by2 },\n\t\t\tA = abc.A,\n\t\t\tv1 = { x: A.x + (e1.x - A.x) / (1 - t), y: A.y + (e1.y - A.y) / (1 - t) },\n\t\t\tv2 = { x: A.x + (e2.x - A.x) / t, y: A.y + (e2.y - A.y) / t },\n\t\t\tnc1 = { x: S.x + (v1.x - S.x) / t, y: S.y + (v1.y - S.y) / t },\n\t\t\tnc2 = {\n\t\t\t\tx: E.x + (v2.x - E.x) / (1 - t),\n\t\t\t\ty: E.y + (v2.y - E.y) / (1 - t),\n\t\t\t};\n\t\t// ...done\n\t\treturn new Bezier(S, nc1, nc2, E);\n\t}\n\n\tstatic getUtils() {\n\t\treturn utils;\n\t}\n\n\tgetUtils() {\n\t\treturn Bezier.getUtils();\n\t}\n\n\tstatic get PolyBezier() {\n\t\treturn PolyBezier;\n\t}\n\n\tvalueOf() {\n\t\treturn this.toString();\n\t}\n\n\ttoString() {\n\t\treturn utils.pointsToString(this.points);\n\t}\n\n\ttoSVG() {\n\t\tif (this._3d) return false;\n\t\tconst p = this.points,\n\t\t\tx = p[0].x,\n\t\t\ty = p[0].y,\n\t\t\ts = [\"M\", x, y, this.order === 2 ? \"Q\" : \"C\"];\n\t\tfor (let i = 1, last = p.length; i < last; i++) {\n\t\t\ts.push(p[i].x);\n\t\t\ts.push(p[i].y);\n\t\t}\n\t\treturn s.join(\" \");\n\t}\n\n\tsetRatios(ratios) {\n\t\tif (ratios.length !== this.points.length) {\n\t\t\tthrow new Error(\"incorrect number of ratio values\");\n\t\t}\n\t\tthis.ratios = ratios;\n\t\tthis._lut = []; //  invalidate any precomputed LUT\n\t}\n\n\tverify() {\n\t\tconst print = this.coordDigest();\n\t\tif (print !== this._print) {\n\t\t\tthis._print = print;\n\t\t\tthis.update();\n\t\t}\n\t}\n\n\tcoordDigest() {\n\t\treturn this.points\n\t\t\t.map(function (c, pos) {\n\t\t\t\treturn \"\" + pos + c.x + c.y + (c.z ? c.z : 0);\n\t\t\t})\n\t\t\t.join(\"\");\n\t}\n\n\tupdate() {\n\t\t// invalidate any precomputed LUT\n\t\tthis._lut = [];\n\t\tthis.dpoints = utils.derive(this.points, this._3d);\n\t\tthis.computedirection();\n\t}\n\n\tcomputedirection() {\n\t\tconst points = this.points;\n\t\tconst angle = utils.angle(points[0], points[this.order], points[1]);\n\t\tthis.clockwise = angle > 0;\n\t}\n\n\tlength() {\n\t\treturn utils.length(this.derivative.bind(this));\n\t}\n\n\tstatic getABC(order = 2, S, B, E, t = 0.5) {\n\t\tconst u = utils.projectionratio(t, order),\n\t\t\tum = 1 - u,\n\t\t\tC = {\n\t\t\t\tx: u * S.x + um * E.x,\n\t\t\t\ty: u * S.y + um * E.y,\n\t\t\t},\n\t\t\ts = utils.abcratio(t, order),\n\t\t\tA = {\n\t\t\t\tx: B.x + (B.x - C.x) / s,\n\t\t\t\ty: B.y + (B.y - C.y) / s,\n\t\t\t};\n\t\treturn { A, B, C, S, E };\n\t}\n\n\tgetABC(t, B) {\n\t\tB = B || this.get(t);\n\t\tlet S = this.points[0];\n\t\tlet E = this.points[this.order];\n\t\treturn Bezier.getABC(this.order, S, B, E, t);\n\t}\n\n\tgetLUT(steps) {\n\t\tthis.verify();\n\t\tsteps = steps || 100;\n\t\tif (this._lut.length === steps) {\n\t\t\treturn this._lut;\n\t\t}\n\t\tthis._lut = [];\n\t\t// We want a range from 0 to 1 inclusive, so\n\t\t// we decrement and then use <= rather than <:\n\t\tsteps--;\n\t\tfor (let i = 0, p, t; i < steps; i++) {\n\t\t\tt = i / (steps - 1);\n\t\t\tp = this.compute(t);\n\t\t\tp.t = t;\n\t\t\tthis._lut.push(p);\n\t\t}\n\t\treturn this._lut;\n\t}\n\n\ton(point, error) {\n\t\terror = error || 5;\n\t\tconst lut = this.getLUT(),\n\t\t\thits = [];\n\t\tfor (let i = 0, c, t = 0; i < lut.length; i++) {\n\t\t\tc = lut[i];\n\t\t\tif (utils.dist(c, point) < error) {\n\t\t\t\thits.push(c);\n\t\t\t\tt += i / lut.length;\n\t\t\t}\n\t\t}\n\t\tif (!hits.length) return false;\n\t\treturn (t /= hits.length);\n\t}\n\n\tproject(point) {\n\t\t// step 1: coarse check\n\t\tconst LUT = this.getLUT(),\n\t\t\tl = LUT.length - 1,\n\t\t\tclosest = utils.closest(LUT, point),\n\t\t\tmpos = closest.mpos,\n\t\t\tt1 = (mpos - 1) / l,\n\t\t\tt2 = (mpos + 1) / l,\n\t\t\tstep = 0.1 / l;\n\n\t\t// step 2: fine check\n\t\tlet mdist = closest.mdist,\n\t\t\tt = t1,\n\t\t\tft = t,\n\t\t\tp;\n\t\tmdist += 1;\n\t\tfor (let d; t < t2 + step; t += step) {\n\t\t\tp = this.compute(t);\n\t\t\td = utils.dist(point, p);\n\t\t\tif (d < mdist) {\n\t\t\t\tmdist = d;\n\t\t\t\tft = t;\n\t\t\t}\n\t\t}\n\t\tft = ft < 0 ? 0 : ft > 1 ? 1 : ft;\n\t\tp = this.compute(ft);\n\t\tp.t = ft;\n\t\tp.d = mdist;\n\t\treturn p;\n\t}\n\n\tget(t) {\n\t\treturn this.compute(t);\n\t}\n\n\tpoint(idx) {\n\t\treturn this.points[idx];\n\t}\n\n\tcompute(t) {\n\t\tif (this.ratios) {\n\t\t\treturn utils.computeWithRatios(t, this.points, this.ratios, this._3d);\n\t\t}\n\t\treturn utils.compute(t, this.points, this._3d, this.ratios);\n\t}\n\n\traise() {\n\t\tconst p = this.points,\n\t\t\tnp = [p[0]],\n\t\t\tk = p.length;\n\t\tfor (let i = 1, pi, pim; i < k; i++) {\n\t\t\tpi = p[i];\n\t\t\tpim = p[i - 1];\n\t\t\tnp[i] = {\n\t\t\t\tx: ((k - i) / k) * pi.x + (i / k) * pim.x,\n\t\t\t\ty: ((k - i) / k) * pi.y + (i / k) * pim.y,\n\t\t\t};\n\t\t}\n\t\tnp[k] = p[k - 1];\n\t\treturn new Bezier(np);\n\t}\n\n\tderivative(t) {\n\t\treturn utils.compute(t, this.dpoints[0]);\n\t}\n\n\tdderivative(t) {\n\t\treturn utils.compute(t, this.dpoints[1]);\n\t}\n\n\talign() {\n\t\tlet p = this.points;\n\t\treturn new Bezier(utils.align(p, { p1: p[0], p2: p[p.length - 1] }));\n\t}\n\n\tcurvature(t) {\n\t\treturn utils.curvature(t, this.dpoints[0], this.dpoints[1], this._3d);\n\t}\n\n\tinflections() {\n\t\treturn utils.inflections(this.points);\n\t}\n\n\tnormal(t) {\n\t\treturn this._3d ? this.__normal3(t) : this.__normal2(t);\n\t}\n\n\t__normal2(t) {\n\t\tconst d = this.derivative(t);\n\t\tconst q = sqrt$1(d.x * d.x + d.y * d.y);\n\t\treturn { x: -d.y / q, y: d.x / q };\n\t}\n\n\t__normal3(t) {\n\t\t// see http://stackoverflow.com/questions/25453159\n\t\tconst r1 = this.derivative(t),\n\t\t\tr2 = this.derivative(t + 0.01),\n\t\t\tq1 = sqrt$1(r1.x * r1.x + r1.y * r1.y + r1.z * r1.z),\n\t\t\tq2 = sqrt$1(r2.x * r2.x + r2.y * r2.y + r2.z * r2.z);\n\t\tr1.x /= q1;\n\t\tr1.y /= q1;\n\t\tr1.z /= q1;\n\t\tr2.x /= q2;\n\t\tr2.y /= q2;\n\t\tr2.z /= q2;\n\t\t// cross product\n\t\tconst c = {\n\t\t\tx: r2.y * r1.z - r2.z * r1.y,\n\t\t\ty: r2.z * r1.x - r2.x * r1.z,\n\t\t\tz: r2.x * r1.y - r2.y * r1.x,\n\t\t};\n\t\tconst m = sqrt$1(c.x * c.x + c.y * c.y + c.z * c.z);\n\t\tc.x /= m;\n\t\tc.y /= m;\n\t\tc.z /= m;\n\t\t// rotation matrix\n\t\tconst R = [\n\t\t\tc.x * c.x,\n\t\t\tc.x * c.y - c.z,\n\t\t\tc.x * c.z + c.y,\n\t\t\tc.x * c.y + c.z,\n\t\t\tc.y * c.y,\n\t\t\tc.y * c.z - c.x,\n\t\t\tc.x * c.z - c.y,\n\t\t\tc.y * c.z + c.x,\n\t\t\tc.z * c.z,\n\t\t];\n\t\t// normal vector:\n\t\tconst n = {\n\t\t\tx: R[0] * r1.x + R[1] * r1.y + R[2] * r1.z,\n\t\t\ty: R[3] * r1.x + R[4] * r1.y + R[5] * r1.z,\n\t\t\tz: R[6] * r1.x + R[7] * r1.y + R[8] * r1.z,\n\t\t};\n\t\treturn n;\n\t}\n\n\thull(t) {\n\t\tlet p = this.points,\n\t\t\t_p = [],\n\t\t\tq = [],\n\t\t\tidx = 0;\n\t\tq[idx++] = p[0];\n\t\tq[idx++] = p[1];\n\t\tq[idx++] = p[2];\n\t\tif (this.order === 3) {\n\t\t\tq[idx++] = p[3];\n\t\t}\n\t\t// we lerp between all points at each iteration, until we have 1 point left.\n\t\twhile (p.length > 1) {\n\t\t\t_p = [];\n\t\t\tfor (let i = 0, pt, l = p.length - 1; i < l; i++) {\n\t\t\t\tpt = utils.lerp(t, p[i], p[i + 1]);\n\t\t\t\tq[idx++] = pt;\n\t\t\t\t_p.push(pt);\n\t\t\t}\n\t\t\tp = _p;\n\t\t}\n\t\treturn q;\n\t}\n\n\tsplit(t1, t2) {\n\t\t// shortcuts\n\t\tif (t1 === 0 && !!t2) {\n\t\t\treturn this.split(t2).left;\n\t\t}\n\t\tif (t2 === 1) {\n\t\t\treturn this.split(t1).right;\n\t\t}\n\n\t\t// no shortcut: use \"de Casteljau\" iteration.\n\t\tconst q = this.hull(t1);\n\t\tconst result = {\n\t\t\tleft:\n\t\t\t\tthis.order === 2\n\t\t\t\t\t? new Bezier([q[0], q[3], q[5]])\n\t\t\t\t\t: new Bezier([q[0], q[4], q[7], q[9]]),\n\t\t\tright:\n\t\t\t\tthis.order === 2\n\t\t\t\t\t? new Bezier([q[5], q[4], q[2]])\n\t\t\t\t\t: new Bezier([q[9], q[8], q[6], q[3]]),\n\t\t\tspan: q,\n\t\t};\n\n\t\t// make sure we bind _t1/_t2 information!\n\t\tresult.left._t1 = utils.map(0, 0, 1, this._t1, this._t2);\n\t\tresult.left._t2 = utils.map(t1, 0, 1, this._t1, this._t2);\n\t\tresult.right._t1 = utils.map(t1, 0, 1, this._t1, this._t2);\n\t\tresult.right._t2 = utils.map(1, 0, 1, this._t1, this._t2);\n\n\t\t// if we have no t2, we're done\n\t\tif (!t2) {\n\t\t\treturn result;\n\t\t}\n\n\t\t// if we have a t2, split again:\n\t\tt2 = utils.map(t2, t1, 1, 0, 1);\n\t\treturn result.right.split(t2).left;\n\t}\n\n\textrema() {\n\t\tconst result = {};\n\t\tlet roots = [];\n\n\t\tthis.dims.forEach(\n\t\t\tfunction (dim) {\n\t\t\t\tlet mfn = function (v) {\n\t\t\t\t\treturn v[dim];\n\t\t\t\t};\n\t\t\t\tlet p = this.dpoints[0].map(mfn);\n\t\t\t\tresult[dim] = utils.droots(p);\n\t\t\t\tif (this.order === 3) {\n\t\t\t\t\tp = this.dpoints[1].map(mfn);\n\t\t\t\t\tresult[dim] = result[dim].concat(utils.droots(p));\n\t\t\t\t}\n\t\t\t\tresult[dim] = result[dim].filter(function (t) {\n\t\t\t\t\treturn t >= 0 && t <= 1;\n\t\t\t\t});\n\t\t\t\troots = roots.concat(result[dim].sort(utils.numberSort));\n\t\t\t}.bind(this)\n\t\t);\n\n\t\tresult.values = roots.sort(utils.numberSort).filter(function (v, idx) {\n\t\t\treturn roots.indexOf(v) === idx;\n\t\t});\n\n\t\treturn result;\n\t}\n\n\tbbox() {\n\t\tconst extrema = this.extrema(),\n\t\t\tresult = {};\n\t\tthis.dims.forEach(\n\t\t\tfunction (d) {\n\t\t\t\tresult[d] = utils.getminmax(this, d, extrema[d]);\n\t\t\t}.bind(this)\n\t\t);\n\t\treturn result;\n\t}\n\n\toverlaps(curve) {\n\t\tconst lbbox = this.bbox(),\n\t\t\ttbbox = curve.bbox();\n\t\treturn utils.bboxoverlap(lbbox, tbbox);\n\t}\n\n\toffset(t, d) {\n\t\tif (typeof d !== \"undefined\") {\n\t\t\tconst c = this.get(t),\n\t\t\t\tn = this.normal(t);\n\t\t\tconst ret = {\n\t\t\t\tc: c,\n\t\t\t\tn: n,\n\t\t\t\tx: c.x + n.x * d,\n\t\t\t\ty: c.y + n.y * d,\n\t\t\t};\n\t\t\tif (this._3d) {\n\t\t\t\tret.z = c.z + n.z * d;\n\t\t\t}\n\t\t\treturn ret;\n\t\t}\n\t\tif (this._linear) {\n\t\t\tconst nv = this.normal(0),\n\t\t\t\tcoords = this.points.map(function (p) {\n\t\t\t\t\tconst ret = {\n\t\t\t\t\t\tx: p.x + t * nv.x,\n\t\t\t\t\t\ty: p.y + t * nv.y,\n\t\t\t\t\t};\n\t\t\t\t\tif (p.z && nv.z) {\n\t\t\t\t\t\tret.z = p.z + t * nv.z;\n\t\t\t\t\t}\n\t\t\t\t\treturn ret;\n\t\t\t\t});\n\t\t\treturn [new Bezier(coords)];\n\t\t}\n\t\treturn this.reduce().map(function (s) {\n\t\t\tif (s._linear) {\n\t\t\t\treturn s.offset(t)[0];\n\t\t\t}\n\t\t\treturn s.scale(t);\n\t\t});\n\t}\n\n\tsimple() {\n\t\tif (this.order === 3) {\n\t\t\tconst a1 = utils.angle(this.points[0], this.points[3], this.points[1]);\n\t\t\tconst a2 = utils.angle(this.points[0], this.points[3], this.points[2]);\n\t\t\tif ((a1 > 0 && a2 < 0) || (a1 < 0 && a2 > 0)) return false;\n\t\t}\n\t\tconst n1 = this.normal(0);\n\t\tconst n2 = this.normal(1);\n\t\tlet s = n1.x * n2.x + n1.y * n2.y;\n\t\tif (this._3d) {\n\t\t\ts += n1.z * n2.z;\n\t\t}\n\t\treturn abs$1(acos$1(s)) < pi$1 / 3;\n\t}\n\n\treduce() {\n\t\t// TODO: examine these var types in more detail...\n\t\tlet i,\n\t\t\tt1 = 0,\n\t\t\tt2 = 0,\n\t\t\tstep = 0.01,\n\t\t\tsegment,\n\t\t\tpass1 = [],\n\t\t\tpass2 = [];\n\t\t// first pass: split on extrema\n\t\tlet extrema = this.extrema().values;\n\t\tif (extrema.indexOf(0) === -1) {\n\t\t\textrema = [0].concat(extrema);\n\t\t}\n\t\tif (extrema.indexOf(1) === -1) {\n\t\t\textrema.push(1);\n\t\t}\n\n\t\tfor (t1 = extrema[0], i = 1; i < extrema.length; i++) {\n\t\t\tt2 = extrema[i];\n\t\t\tsegment = this.split(t1, t2);\n\t\t\tsegment._t1 = t1;\n\t\t\tsegment._t2 = t2;\n\t\t\tpass1.push(segment);\n\t\t\tt1 = t2;\n\t\t}\n\n\t\t// second pass: further reduce these segments to simple segments\n\t\tpass1.forEach(function (p1) {\n\t\t\tt1 = 0;\n\t\t\tt2 = 0;\n\t\t\twhile (t2 <= 1) {\n\t\t\t\tfor (t2 = t1 + step; t2 <= 1 + step; t2 += step) {\n\t\t\t\t\tsegment = p1.split(t1, t2);\n\t\t\t\t\tif (!segment.simple()) {\n\t\t\t\t\t\tt2 -= step;\n\t\t\t\t\t\tif (abs$1(t1 - t2) < step) {\n\t\t\t\t\t\t\t// we can never form a reduction\n\t\t\t\t\t\t\treturn [];\n\t\t\t\t\t\t}\n\t\t\t\t\t\tsegment = p1.split(t1, t2);\n\t\t\t\t\t\tsegment._t1 = utils.map(t1, 0, 1, p1._t1, p1._t2);\n\t\t\t\t\t\tsegment._t2 = utils.map(t2, 0, 1, p1._t1, p1._t2);\n\t\t\t\t\t\tpass2.push(segment);\n\t\t\t\t\t\tt1 = t2;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (t1 < 1) {\n\t\t\t\tsegment = p1.split(t1, 1);\n\t\t\t\tsegment._t1 = utils.map(t1, 0, 1, p1._t1, p1._t2);\n\t\t\t\tsegment._t2 = p1._t2;\n\t\t\t\tpass2.push(segment);\n\t\t\t}\n\t\t});\n\t\treturn pass2;\n\t}\n\n\tscale(d) {\n\t\tconst order = this.order;\n\t\tlet distanceFn = false;\n\t\tif (typeof d === \"function\") {\n\t\t\tdistanceFn = d;\n\t\t}\n\t\tif (distanceFn && order === 2) {\n\t\t\treturn this.raise().scale(distanceFn);\n\t\t}\n\n\t\t// TODO: add special handling for degenerate (=linear) curves.\n\t\tconst clockwise = this.clockwise;\n\t\tconst r1 = distanceFn ? distanceFn(0) : d;\n\t\tconst r2 = distanceFn ? distanceFn(1) : d;\n\t\tconst v = [this.offset(0, 10), this.offset(1, 10)];\n\t\tconst points = this.points;\n\t\tconst np = [];\n\t\tconst o = utils.lli4(v[0], v[0].c, v[1], v[1].c);\n\n\t\tif (!o) {\n\t\t\tthrow new Error(\"cannot scale this curve. Try reducing it first.\");\n\t\t}\n\t\t// move all points by distance 'd' wrt the origin 'o'\n\n\t\t// move end points by fixed distance along normal.\n\t\t[0, 1].forEach(function (t) {\n\t\t\tconst p = (np[t * order] = utils.copy(points[t * order]));\n\t\t\tp.x += (t ? r2 : r1) * v[t].n.x;\n\t\t\tp.y += (t ? r2 : r1) * v[t].n.y;\n\t\t});\n\n\t\tif (!distanceFn) {\n\t\t\t// move control points to lie on the intersection of the offset\n\t\t\t// derivative vector, and the origin-through-control vector\n\t\t\t[0, 1].forEach((t) => {\n\t\t\t\tif (order === 2 && !!t) return;\n\t\t\t\tconst p = np[t * order];\n\t\t\t\tconst d = this.derivative(t);\n\t\t\t\tconst p2 = { x: p.x + d.x, y: p.y + d.y };\n\t\t\t\tnp[t + 1] = utils.lli4(p, p2, o, points[t + 1]);\n\t\t\t});\n\t\t\treturn new Bezier(np);\n\t\t}\n\n\t\t// move control points by \"however much necessary to\n\t\t// ensure the correct tangent to endpoint\".\n\t\t[0, 1].forEach(function (t) {\n\t\t\tif (order === 2 && !!t) return;\n\t\t\tvar p = points[t + 1];\n\t\t\tvar ov = {\n\t\t\t\tx: p.x - o.x,\n\t\t\t\ty: p.y - o.y,\n\t\t\t};\n\t\t\tvar rc = distanceFn ? distanceFn((t + 1) / order) : d;\n\t\t\tif (distanceFn && !clockwise) rc = -rc;\n\t\t\tvar m = sqrt$1(ov.x * ov.x + ov.y * ov.y);\n\t\t\tov.x /= m;\n\t\t\tov.y /= m;\n\t\t\tnp[t + 1] = {\n\t\t\t\tx: p.x + rc * ov.x,\n\t\t\t\ty: p.y + rc * ov.y,\n\t\t\t};\n\t\t});\n\t\treturn new Bezier(np);\n\t}\n\n\toutline(d1, d2, d3, d4) {\n\t\td2 = typeof d2 === \"undefined\" ? d1 : d2;\n\t\tconst reduced = this.reduce(),\n\t\t\tlen = reduced.length,\n\t\t\tfcurves = [];\n\n\t\tlet bcurves = [],\n\t\t\tp,\n\t\t\talen = 0,\n\t\t\ttlen = this.length();\n\n\t\tconst graduated = typeof d3 !== \"undefined\" && typeof d4 !== \"undefined\";\n\n\t\tfunction linearDistanceFunction(s, e, tlen, alen, slen) {\n\t\t\treturn function (v) {\n\t\t\t\tconst f1 = alen / tlen,\n\t\t\t\t\tf2 = (alen + slen) / tlen,\n\t\t\t\t\td = e - s;\n\t\t\t\treturn utils.map(v, 0, 1, s + f1 * d, s + f2 * d);\n\t\t\t};\n\t\t}\n\n\t\t// form curve oulines\n\t\treduced.forEach(function (segment) {\n\t\t\tconst slen = segment.length();\n\t\t\tif (graduated) {\n\t\t\t\tfcurves.push(\n\t\t\t\t\tsegment.scale(linearDistanceFunction(d1, d3, tlen, alen, slen))\n\t\t\t\t);\n\t\t\t\tbcurves.push(\n\t\t\t\t\tsegment.scale(linearDistanceFunction(-d2, -d4, tlen, alen, slen))\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\tfcurves.push(segment.scale(d1));\n\t\t\t\tbcurves.push(segment.scale(-d2));\n\t\t\t}\n\t\t\talen += slen;\n\t\t});\n\n\t\t// reverse the \"return\" outline\n\t\tbcurves = bcurves\n\t\t\t.map(function (s) {\n\t\t\t\tp = s.points;\n\t\t\t\tif (p[3]) {\n\t\t\t\t\ts.points = [p[3], p[2], p[1], p[0]];\n\t\t\t\t} else {\n\t\t\t\t\ts.points = [p[2], p[1], p[0]];\n\t\t\t\t}\n\t\t\t\treturn s;\n\t\t\t})\n\t\t\t.reverse();\n\n\t\t// form the endcaps as lines\n\t\tconst fs = fcurves[0].points[0],\n\t\t\tfe = fcurves[len - 1].points[fcurves[len - 1].points.length - 1],\n\t\t\tbs = bcurves[len - 1].points[bcurves[len - 1].points.length - 1],\n\t\t\tbe = bcurves[0].points[0],\n\t\t\tls = utils.makeline(bs, fs),\n\t\t\tle = utils.makeline(fe, be),\n\t\t\tsegments = [ls].concat(fcurves).concat([le]).concat(bcurves);\n\n\t\treturn new PolyBezier(segments);\n\t}\n\n\toutlineshapes(d1, d2, curveIntersectionThreshold) {\n\t\td2 = d2 || d1;\n\t\tconst outline = this.outline(d1, d2).curves;\n\t\tconst shapes = [];\n\t\tfor (let i = 1, len = outline.length; i < len / 2; i++) {\n\t\t\tconst shape = utils.makeshape(\n\t\t\t\toutline[i],\n\t\t\t\toutline[len - i],\n\t\t\t\tcurveIntersectionThreshold\n\t\t\t);\n\t\t\tshape.startcap.virtual = i > 1;\n\t\t\tshape.endcap.virtual = i < len / 2 - 1;\n\t\t\tshapes.push(shape);\n\t\t}\n\t\treturn shapes;\n\t}\n\n\tintersects(curve, curveIntersectionThreshold) {\n\t\tif (!curve) return this.selfintersects(curveIntersectionThreshold);\n\t\tif (curve.p1 && curve.p2) {\n\t\t\treturn this.lineIntersects(curve);\n\t\t}\n\t\tif (curve instanceof Bezier) {\n\t\t\tcurve = curve.reduce();\n\t\t}\n\t\treturn this.curveintersects(\n\t\t\tthis.reduce(),\n\t\t\tcurve,\n\t\t\tcurveIntersectionThreshold\n\t\t);\n\t}\n\n\tlineIntersects(line) {\n\t\tconst mx = min(line.p1.x, line.p2.x),\n\t\t\tmy = min(line.p1.y, line.p2.y),\n\t\t\tMX = max(line.p1.x, line.p2.x),\n\t\t\tMY = max(line.p1.y, line.p2.y);\n\t\treturn utils.roots(this.points, line).filter((t) => {\n\t\t\tvar p = this.get(t);\n\t\t\treturn utils.between(p.x, mx, MX) && utils.between(p.y, my, MY);\n\t\t});\n\t}\n\n\tselfintersects(curveIntersectionThreshold) {\n\t\t// \"simple\" curves cannot intersect with their direct\n\t\t// neighbour, so for each segment X we check whether\n\t\t// it intersects [0:x-2][x+2:last].\n\n\t\tconst reduced = this.reduce(),\n\t\t\tlen = reduced.length - 2,\n\t\t\tresults = [];\n\n\t\tfor (let i = 0, result, left, right; i < len; i++) {\n\t\t\tleft = reduced.slice(i, i + 1);\n\t\t\tright = reduced.slice(i + 2);\n\t\t\tresult = this.curveintersects(left, right, curveIntersectionThreshold);\n\t\t\tresults.push(...result);\n\t\t}\n\t\treturn results;\n\t}\n\n\tcurveintersects(c1, c2, curveIntersectionThreshold) {\n\t\tconst pairs = [];\n\t\t// step 1: pair off any overlapping segments\n\t\tc1.forEach(function (l) {\n\t\t\tc2.forEach(function (r) {\n\t\t\t\tif (l.overlaps(r)) {\n\t\t\t\t\tpairs.push({ left: l, right: r });\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t\t// step 2: for each pairing, run through the convergence algorithm.\n\t\tlet intersections = [];\n\t\tpairs.forEach(function (pair) {\n\t\t\tconst result = utils.pairiteration(\n\t\t\t\tpair.left,\n\t\t\t\tpair.right,\n\t\t\t\tcurveIntersectionThreshold\n\t\t\t);\n\t\t\tif (result.length > 0) {\n\t\t\t\tintersections = intersections.concat(result);\n\t\t\t}\n\t\t});\n\t\treturn intersections;\n\t}\n\n\tarcs(errorThreshold) {\n\t\terrorThreshold = errorThreshold || 0.5;\n\t\treturn this._iterate(errorThreshold, []);\n\t}\n\n\t_error(pc, np1, s, e) {\n\t\tconst q = (e - s) / 4,\n\t\t\tc1 = this.get(s + q),\n\t\t\tc2 = this.get(e - q),\n\t\t\tref = utils.dist(pc, np1),\n\t\t\td1 = utils.dist(pc, c1),\n\t\t\td2 = utils.dist(pc, c2);\n\t\treturn abs$1(d1 - ref) + abs$1(d2 - ref);\n\t}\n\n\t_iterate(errorThreshold, circles) {\n\t\tlet t_s = 0,\n\t\t\tt_e = 1,\n\t\t\tsafety;\n\t\t// we do a binary search to find the \"good `t` closest to no-longer-good\"\n\t\tdo {\n\t\t\tsafety = 0;\n\n\t\t\t// step 1: start with the maximum possible arc\n\t\t\tt_e = 1;\n\n\t\t\t// points:\n\t\t\tlet np1 = this.get(t_s),\n\t\t\t\tnp2,\n\t\t\t\tnp3,\n\t\t\t\tarc,\n\t\t\t\tprev_arc;\n\n\t\t\t// booleans:\n\t\t\tlet curr_good = false,\n\t\t\t\tprev_good = false,\n\t\t\t\tdone;\n\n\t\t\t// numbers:\n\t\t\tlet t_m = t_e,\n\t\t\t\tprev_e = 1;\n\n\t\t\t// step 2: find the best possible arc\n\t\t\tdo {\n\t\t\t\tprev_good = curr_good;\n\t\t\t\tprev_arc = arc;\n\t\t\t\tt_m = (t_s + t_e) / 2;\n\n\t\t\t\tnp2 = this.get(t_m);\n\t\t\t\tnp3 = this.get(t_e);\n\n\t\t\t\tarc = utils.getccenter(np1, np2, np3);\n\n\t\t\t\t//also save the t values\n\t\t\t\tarc.interval = {\n\t\t\t\t\tstart: t_s,\n\t\t\t\t\tend: t_e,\n\t\t\t\t};\n\n\t\t\t\tlet error = this._error(arc, np1, t_s, t_e);\n\t\t\t\tcurr_good = error <= errorThreshold;\n\n\t\t\t\tdone = prev_good && !curr_good;\n\t\t\t\tif (!done) prev_e = t_e;\n\n\t\t\t\t// this arc is fine: we can move 'e' up to see if we can find a wider arc\n\t\t\t\tif (curr_good) {\n\t\t\t\t\t// if e is already at max, then we're done for this arc.\n\t\t\t\t\tif (t_e >= 1) {\n\t\t\t\t\t\t// make sure we cap at t=1\n\t\t\t\t\t\tarc.interval.end = prev_e = 1;\n\t\t\t\t\t\tprev_arc = arc;\n\t\t\t\t\t\t// if we capped the arc segment to t=1 we also need to make sure that\n\t\t\t\t\t\t// the arc's end angle is correct with respect to the bezier end point.\n\t\t\t\t\t\tif (t_e > 1) {\n\t\t\t\t\t\t\tlet d = {\n\t\t\t\t\t\t\t\tx: arc.x + arc.r * cos$1(arc.e),\n\t\t\t\t\t\t\t\ty: arc.y + arc.r * sin$1(arc.e),\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\tarc.e += utils.angle({ x: arc.x, y: arc.y }, d, this.get(1));\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\t// if not, move it up by half the iteration distance\n\t\t\t\t\tt_e = t_e + (t_e - t_s) / 2;\n\t\t\t\t} else {\n\t\t\t\t\t// this is a bad arc: we need to move 'e' down to find a good arc\n\t\t\t\t\tt_e = t_m;\n\t\t\t\t}\n\t\t\t} while (!done && safety++ < 100);\n\n\t\t\tif (safety >= 100) {\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\t// console.log(\"L835: [F] arc found\", t_s, prev_e, prev_arc.x, prev_arc.y, prev_arc.s, prev_arc.e);\n\n\t\t\tprev_arc = prev_arc ? prev_arc : arc;\n\t\t\tcircles.push(prev_arc);\n\t\t\tt_s = prev_e;\n\t\t} while (t_e < 1);\n\t\treturn circles;\n\t}\n}\n\nexport { Bezier };","\nimport { BezierTool, ToolMode } from './BezierTool';\nimport { PointArrayInputHandler, InputHandler, PointInputHandler, InitializerInputHandler } from \"./ToolInputHandler\";\nimport { CurvyWallControl } from '../CurvyWallsToolBar';\nimport { Bezier } from '../../libs/bezier';\n\nconst pointNearPoint = BezierTool.pointNearPoint;\ndeclare type Point = PIXI.Point;\n\nclass InitializerIH extends InitializerInputHandler {\n\tprivate get quadTool(): QuadTool { return this.tool as QuadTool; }\n\tconstructor(tool: QuadTool, success: () => void, fail: () => void) {\n\t\tsuper(tool, false, tool.lineA, tool.lineB, success, fail);\n\t}\n\tmove(origin: Point, destination: Point, event: PIXI.InteractionEvent): void {\n\t\tsuper.move(origin, destination, event);\n\t\tconst cX = (this.tool.lineB.x + this.tool.lineA.x) / 2;\n\t\tconst cY = (this.tool.lineB.y + this.tool.lineA.y) / 2;\n\t\tlet nY = -(this.tool.lineB.x - this.tool.lineA.x);\n\t\tlet nX = this.tool.lineB.y - this.tool.lineA.y;\n\t\t// const length = Math.sqrt((nX * nX) + (nY * nY));\n\t\tnX *= 0.25;\n\t\tnY *= 0.25;\n\t\tthis.quadTool.control.set(cX + nX, cY + nY);\n\t}\n}\n\nexport default class QuadTool extends BezierTool {\n\tprivate bezier: Bezier;\n\tlineA = new PIXI.Point();\n\tlineB = new PIXI.Point();\n\tcontrol = new PIXI.Point();\n\n\tget handles(): Point[] { return [this.lineA, this.control, this.lineB]; }\n\tget bounds(): PIXI.Bounds {\n\t\tconst b = new PIXI.Bounds();\n\t\tb.addPoint(this.lineA);\n\t\tb.addPoint(this.lineB);\n\t\tb.addPoint(this.control);\n\t\treturn b;\n\t}\n\tget polygon(): PIXI.Polygon { return new PIXI.Polygon([this.lineA, this.lineB, this.control]); }\n\n\tconstructor(segments: number = 10) {\n\t\tsuper(segments);\n\t\t// this.bezier = new Bezier([0, 0, 0, 0, 0, 0]);\n\t}\n\n\tgetSegments(count: number): PIXI.Point[] | PIXI.Point[][] {\n\t\tif (this.mode == ToolMode.NotPlaced) return [];\n\t\tthis.bezier = Bezier.quadraticFromPoints(this.lineA, this.control, this.lineB);\n\t\t// this.bezier.points = this.handles;\n\t\t// this.bezier.update();\n\t\treturn (this.lastSegmentFetch = this.bezier.getLUT(count + 2).map((e: { x: number, y: number }) => new PIXI.Point(e.x, e.y)));\n\t}\n\tdrawHandles(context: PIXI.Graphics): void {\n\t\tif (this.mode == ToolMode.NotPlaced) return;\n\t\tthis.drawBoundingBox(context);\n\t\t// context.beginFill(0xffaacc)\n\t\t// \t.lineStyle(BezierTool.LINE_SIZE, 0xffaacc, 1, 0.5)\n\t\t// \t.moveTo(this.lineA.x, this.lineA.y)\n\t\t// \t.lineTo(this.control.x, this.control.y)\n\t\t// \t.moveTo(this.lineB.x, this.lineB.y)\n\t\t// \t.lineTo(this.control.x, this.control.y)\n\t\t// \t.endFill();\n\t\tsuper.drawSegmentLabel(context);\n\t\tthis.drawHandle(context, 0xff4444, this.lineA);\n\t\tthis.drawHandle(context, 0xff4444, this.lineB);\n\t\tthis.drawHandle(context, 0xaaff44, this.control);\n\t}\n\tcheckPointForDrag(point: Point): InputHandler | null {\n\t\tif (this.mode == ToolMode.NotPlaced) {\n\t\t\tthis.setMode(ToolMode.Placing);\n\t\t\treturn new InitializerIH(this, () => this.setMode(ToolMode.Placed), () => this.setMode(ToolMode.NotPlaced));\n\t\t}\n\t\tif (pointNearPoint(point, this.lineA, BezierTool.HANDLE_RADIUS))\n\t\t\treturn new PointInputHandler(this, this.lineA);\n\t\telse if (pointNearPoint(point, this.lineB, BezierTool.HANDLE_RADIUS))\n\t\t\treturn new PointInputHandler(this, this.lineB);\n\t\telse if (pointNearPoint(point, this.control, BezierTool.HANDLE_RADIUS))\n\t\t\treturn new PointInputHandler(this, this.control);\n\t\telse if (this.polygon.contains(point.x, point.y))\n\t\t\treturn new PointArrayInputHandler(this, point, this.handles);\n\t\treturn null;\n\t}\n\n\tgetTools(): Record<string, CurvyWallControl> { return {}; }\n\tplaceTool(point: PIXI.Point, data: { l1: number[], l2: number[], c: number[] }) {\n\t\tthis.lineA.set(data.l1[0] + point.x, data.l1[1] + point.y);\n\t\tthis.lineB.set(data.l2[0] + point.x, data.l2[1] + point.y);\n\t\tthis.control.set(data.c[0] + point.x, data.c[1] + point.y);\n\t\tthis.setMode(ToolMode.Placed);\n\t}\n\tgetData() {\n\t\tconst center = this.lineCenter;\n\t\treturn {\n\t\t\tl1: [this.lineA.x - center.x, this.lineA.y - center.y],\n\t\t\tl2: [this.lineB.x - center.x, this.lineB.y - center.y],\n\t\t\tc: [this.control.x - center.x, this.control.y - center.y]\n\t\t};\n\t}\n}","import { CurvyWallControl } from \"../CurvyWallsToolBar\";\nimport { CurvyWallToolManager, Mode } from \"../CurvyWallToolManager\";\nimport { Bezier } from \"../../libs/bezier\";\nimport { BezierTool } from \"./BezierTool\";\nimport { InputHandler, PointInputHandler } from \"./ToolInputHandler\";\n\nconst pointNearPoint = BezierTool.pointNearPoint;\n\nexport default class PointMapper extends BezierTool {\n\tget handles(): PIXI.Point[] {\n\t\tthrow new Error(\"Method not implemented.\");\n\t}\n\tget bounds(): PIXI.Bounds {\n\t\tconst b = new PIXI.Bounds();\n\t\tthis.points.forEach(x => b.addPoint(x));\n\t\treturn b;\n\t}\n\tlineA = new PIXI.Point();\n\tlineB = new PIXI.Point();\n\tpoints: PIXI.Point[] = [];\n\n\tdrawHandles(context: PIXI.Graphics): void {\n\t\tthis.drawBoundingBox(context);\n\t\tswitch (CurvyWallToolManager.instance.mode) {\n\t\t\t// case Mode.Cube:\n\t\t\t// \tif (this.points.length < 3) break;\n\t\t\t// \tlet lines = Bezier.cubicFromPoints(this.points[0], this.points[1], this.points[2])\n\t\t\t// \t\t.getLUT().map((p: { x: number, y: number }) => new PIXI.Point(p.x, p.y));\n\t\t\t// \tcontext.beginFill(0, 0).lineStyle(6, 0xffaacc, 1, 0.5)\n\t\t\t// \tcontext.moveTo(lines[0].x, lines[0].y)\n\t\t\t// \tfor (let c = 1; c < lines.length; c++)\n\t\t\t// \t\tcontext.lineTo(lines[c].x, lines[c].y)\n\t\t\t// \tcontext.endFill();\n\t\t\t// \tbreak;\n\t\t\tcase Mode.Quad:\n\t\t\t\tif (this.points.length < 3) break;\n\t\t\t\tconst lines = Bezier.quadraticFromPoints(this.points[0], this.points[1], this.points[2])\n\t\t\t\t\t.getLUT().map((p: { x: number, y: number }) => new PIXI.Point(p.x, p.y));\n\t\t\t\tcontext.beginFill(0, 0).lineStyle(6, 0xffaacc, 1, 0.5);\n\t\t\t\tcontext.moveTo(lines[0].x, lines[0].y);\n\t\t\t\tfor (let c = 1; c < lines.length; c++)\n\t\t\t\t\tcontext.lineTo(lines[c].x, lines[c].y);\n\t\t\t\tcontext.endFill();\n\t\t\t\tbreak;\n\t\t\tcase Mode.Circ:\n\t\t\t\tif (this.points.length < 2) break;\n\t\t\t\tconst dimensions = this._calculateCircle();\n\t\t\t\tcontext.beginFill(0, 0)\n\t\t\t\t\t.lineStyle(6, 0xffaacc, 1, 0.5)\n\t\t\t\t\t.drawEllipse(dimensions.x, dimensions.y, dimensions.w, dimensions.h)\n\t\t\t\t\t.endFill();\n\t\t\t\tbreak;\n\t\t\tcase Mode.Rect:\n\t\t\t\tif (this.points.length == 0) break;\n\t\t\t\tconst bounds = this.bounds;\n\t\t\t\tcontext.beginFill(0, 0)\n\t\t\t\t\t.lineStyle(6, 0xffaacc, 1, 0.5)\n\t\t\t\t\t.drawRect(bounds.minX, bounds.minY, bounds.maxX - bounds.minX, bounds.maxY - bounds.minY)\n\t\t\t\t\t.endFill();\n\t\t\t\tbreak;\n\t\t}\n\t\tconst fill = [0x44ffaa, 0xff4444, 0x4444ff, 0xdd44dd, 0xdddd44];\n\t\tthis.points.forEach((x, idx) => this.drawHandle(context, fill[idx], x));\n\t}\n\tcheckPointForClick(point: PIXI.Point, event: PIXI.InteractionEvent): boolean {\n\t\tconst utility = new PointInputHandler(this, point);\n\t\tconst snap = utility.shouldSnap(event);\n\n\t\tif (event.data.originalEvent.ctrlKey) {\n\t\t\tconst handle = this.points.findIndex(e => pointNearPoint(point, e, BezierTool.HANDLE_RADIUS));\n\t\t\tif (handle < 0) return false;\n\t\t\tthis.points.splice(handle, 1);\n\t\t\treturn true;\n\t\t}\n\t\t// If we are clicking on an already existing point, or we have max points\n\t\tif (this.points.find(e => pointNearPoint(point, e, BezierTool.HANDLE_RADIUS))) return false;\n\n\t\tswitch (CurvyWallToolManager.instance.mode) {\n\t\t\t// case Mode.Cube:\n\t\t\tcase Mode.Quad:\n\t\t\t\tif (this.points.length == 3) return false;\n\t\t\t\tthis.points.push(utility.getWallEndPoint(point, snap));\n\t\t\t\treturn true;\n\t\t\tcase Mode.Circ:\n\t\t\t// if (this.points.length == 4) return false;\n\t\t\t// this.points.push(utility.getWallEndPoint(point, snap));\n\t\t\t// return true;\n\t\t\t\t// fallthrough\n\t\t\tcase Mode.Rect:\n\t\t\t\tif (this.points.length == 4) return false;\n\t\t\t\tthis.points.push(utility.getWallEndPoint(point, snap));\n\t\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\tcheckPointForDrag(point: PIXI.Point): InputHandler | null {\n\t\tconst target = this.points.find(x => pointNearPoint(point, x, BezierTool.HANDLE_RADIUS));\n\t\tif (!target) return null;\n\t\treturn new PointInputHandler(this, target);\n\t}\n\n\tgetTooltipMessage(): string {\n\t\tswitch (CurvyWallToolManager.instance.mode) {\n\t\t\t// case Mode.Cube:\n\t\t\t// \treturn \"You need to place 3 points to generate a Bezier Cubic Curve.\";\n\t\t\tcase Mode.Quad: return \"df-curvy-walls.pointmap_quad\";\n\t\t\tcase Mode.Circ: return \"df-curvy-walls.pointmap_circ\";\n\t\t\tcase Mode.Rect: return \"df-curvy-walls.pointmap_rect\";\n\t\t}\n\t\treturn \"\";\n\t}\n\thasEnoughData(): boolean {\n\t\tswitch (CurvyWallToolManager.instance.mode) {\n\t\t\t// case Mode.Cube:\n\t\t\tcase Mode.Quad:\n\t\t\t\treturn this.points.length == 3;\n\t\t\tcase Mode.Circ:\n\t\t\tcase Mode.Rect:\n\t\t\t\treturn this.points.length >= 2;\n\t\t}\n\t\treturn false;\n\t}\n\n\tbindData(tool: BezierTool) {\n\t\tswitch (CurvyWallToolManager.instance.mode) {\n\t\t\t// case Mode.Cube:\n\t\t\t// \tcurve = Bezier.cubicFromPoints(this.points[0], this.points[1], this.points[2]);\n\t\t\t// \ttool.lineA.copyFrom(curve.points[0]);\n\t\t\t// \ttool.lineB.copyFrom(curve.points[3]);\n\t\t\t// \t(<PIXI.Point>(<any>tool).controlA).copyFrom(curve.points[1]);\n\t\t\t// \t(<PIXI.Point>(<any>tool).controlB).copyFrom(curve.points[2]);\n\t\t\t// \tbreak;\n\t\t\tcase Mode.Quad:\n\t\t\t\ttool.lineA.copyFrom(this.points[0]);\n\t\t\t\ttool.lineB.copyFrom(this.points[2]);\n\t\t\t\t(<PIXI.Point>(<any>tool).control).copyFrom(this.points[1]);\n\t\t\t\tbreak;\n\t\t\tcase Mode.Circ:\n\t\t\t\tconst dimens = this._calculateCircle();\n\t\t\t\ttool.lineA.set(dimens.x - dimens.w, dimens.y - dimens.h);\n\t\t\t\ttool.lineB.set(dimens.x + dimens.w, dimens.y + dimens.h);\n\t\t\t\tbreak;\n\t\t\tcase Mode.Rect:\n\t\t\t\tconst bounds = this.bounds;\n\t\t\t\ttool.lineA.set(bounds.minX, bounds.minY);\n\t\t\t\ttool.lineB.set(bounds.maxX, bounds.maxY);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tprivate _calculateCircle(): { x: number, y: number, w: number, h: number } {\n\t\tconst result: { x: number, y: number, w: number, h: number } = { x: 0, y: 0, w: 0, h: 0 };\n\t\tif (this.points.length == 2) {\n\t\t\tresult.x = this.points[0].x;\n\t\t\tresult.y = this.points[0].y;\n\t\t\tconst size = Math.sqrt(Math.pow(this.points[1].x - result.x, 2) + Math.pow(this.points[1].y - result.y, 2));\n\t\t\tresult.w = size;\n\t\t\tresult.h = size;\n\t\t} else if (this.points.length == 3) {\n\t\t\tconst p1 = this.points[0];\n\t\t\tconst p2 = this.points[1];\n\t\t\tconst p3 = this.points[2];\n\t\t\tconst circle = generateCircle(p1, p2, p3);\n\t\t\tresult.x = circle.center.x;\n\t\t\tresult.y = circle.center.y;\n\t\t\tresult.w = circle.radius;\n\t\t\tresult.h = circle.radius;\n\t\t} else if (this.points.length == 4) {\n\t\t\tconst bounds = this.bounds;\n\t\t\tresult.x = (bounds.minX + bounds.maxX) / 2;\n\t\t\tresult.y = (bounds.minY + bounds.maxY) / 2;\n\t\t\tresult.w = (bounds.maxX - bounds.minX) / 2;\n\t\t\tresult.h = (bounds.maxY - bounds.minY) / 2;\n\t\t}\n\t\treturn result;\n\t}\n\n\tgetSegments(_count: number): PIXI.Point[] | PIXI.Point[][] { throw new Error(\"Method not implemented.\"); }\n\tplaceTool(_point: PIXI.Point, _data: object): void { throw new Error(\"Method not implemented.\"); }\n\tgetData(): object { throw new Error(\"Method not implemented.\"); }\n\tgetTools(): Record<string, CurvyWallControl> { throw new Error(\"Method not implemented.\"); }\n}\n\nfunction isPerpendicular(p1: Point, p2: Point, p3: Point): boolean {\n\tconst yDelta_a: number = p2.y - p1.y;\n\tconst xDelta_a: number = p2.x - p1.x;\n\tconst yDelta_b: number = p3.y - p2.y;\n\tconst xDelta_b: number = p3.x - p2.x;\n\t// checking whether the line of the two pts are vertical\n\tif (Math.abs(xDelta_a) <= 0.000000001 && Math.abs(yDelta_b) <= 0.000000001) {\n\t\treturn false;\n\t}\n\tif (Math.abs(yDelta_a) <= 0.0000001) return true;\n\telse if (Math.abs(yDelta_b) <= 0.0000001) return true;\n\telse if (Math.abs(xDelta_a) <= 0.000000001) return true;\n\telse if (Math.abs(xDelta_b) <= 0.000000001) return true;\n\telse return false;\n}\nfunction calcCircle(pt1: Point, pt2: Point, pt3: Point): { center: Point, radius: number } {\n\tconst yDelta_a = pt2.y - pt1.y;\n\tconst xDelta_a = pt2.x - pt1.x;\n\tconst yDelta_b = pt3.y - pt2.y;\n\tconst xDelta_b = pt3.x - pt2.x;\n\tconst center = new PIXI.Point();\n\tlet radius = 0;\n\n\tif (Math.abs(xDelta_a) <= 0.000000001 && Math.abs(yDelta_b) <= 0.000000001) {\n\t\tcenter.x = 0.5 * (pt2.x + pt3.x);\n\t\tcenter.y = 0.5 * (pt1.y + pt2.y);\n\t\tradius = Math.sqrt(Math.pow(pt1.x - center.x, 2) + Math.pow(pt1.y - center.y, 2));\n\t\treturn { center, radius };\n\t}\n\n\t// IsPerpendicular() assure that xDelta(s) are not zero\n\tconst aSlope = yDelta_a / xDelta_a;\n\tconst bSlope = yDelta_b / xDelta_b;\n\tif (Math.abs(aSlope - bSlope) <= 0.000000001) {// checking whether the given points are colinear. \t\n\t\treturn { center, radius: -1 };\n\t}\n\n\t// calc center\n\tcenter.x = (aSlope * bSlope * (pt1.y - pt3.y) + bSlope * (pt1.x + pt2.x) - aSlope * (pt2.x + pt3.x)) / (2 * (bSlope - aSlope));\n\tcenter.y = -1 * (center.x - (pt1.x + pt2.x) / 2) / aSlope + (pt1.y + pt2.y) / 2;\n\n\tradius = Math.sqrt(Math.pow(pt1.x - center.x, 2) + Math.pow(pt1.y - center.y, 2));\n\treturn { center, radius };\n}\n\nfunction generateCircle(pt1: Point, pt2: Point, pt3: Point): { center: Point, radius: number } {\n\tif (!isPerpendicular(pt1, pt2, pt3)) return calcCircle(pt1, pt2, pt3);\n\telse if (!isPerpendicular(pt1, pt3, pt2)) return calcCircle(pt1, pt3, pt2);\n\telse if (!isPerpendicular(pt2, pt1, pt3)) return calcCircle(pt2, pt1, pt3);\n\telse if (!isPerpendicular(pt2, pt3, pt1)) return calcCircle(pt2, pt3, pt1);\n\telse if (!isPerpendicular(pt3, pt2, pt1)) return calcCircle(pt3, pt2, pt1);\n\telse if (!isPerpendicular(pt3, pt1, pt2)) return calcCircle(pt3, pt1, pt2);\n\telse return { center: null, radius: -1 };\n}","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import { CurvyWallsToolBar } from './CurvyWallsToolBar';\nimport { CurvyWallToolManager, Mode } from './CurvyWallToolManager';\nimport SETTINGS from \"../../common/Settings\";\nimport { BezierTool } from './tools/BezierTool';\n\nconst curvyWallApp = new CurvyWallsToolBar();\nSETTINGS.init('df-curvy-walls');\n\nHooks.once('init', function() {\n\tSETTINGS.register(CurvyWallsToolBar.PREF_PRESERVE, {\n\t\tscope: 'world',\n\t\ttype: Boolean,\n\t\tconfig: true,\n\t\tdefault: true,\n\t\tname: 'df-curvy-walls.SettingPreserve_Name',\n\t\thint: 'df-curvy-walls.SettingPreserve_Hint',\n\t});\n\tSETTINGS.register(CurvyWallToolManager.PREF_DROP_KEY, {\n\t\tname: 'df-curvy-walls.SettingDropKey_Name',\n\t\thint: 'df-curvy-walls.SettingDropKey_Hint',\n\t\tconfig: true,\n\t\tscope: 'world',\n\t\tchoices: {\n\t\t\talt: 'df-curvy-walls.SettingDropKey_OptionAlt',\n\t\t\tctrl: 'df-curvy-walls.SettingDropKey_OptionCtrl'\n\t\t},\n\t\tdefault: 'alt',\n\t\ttype: String\n\t});\n\tSETTINGS.register(BezierTool.PREF_SMALL_HANDLES, {\n\t\tname: 'df-curvy-walls.SettingSmallHandlesName',\n\t\thint: 'df-curvy-walls.SettingSmallHandlesHint',\n\t\tconfig: true,\n\t\tscope: 'world',\n\t\ttype: Boolean,\n\t\tdefault: false,\n\t});\n\t\n\tgame.keybindings.register(SETTINGS.MOD_NAME, 'applyTool', {\n\t\tname: 'df-curvy-walls.apply',\n\t\teditable: [{ key: \"Enter\" }],\n\t\tonDown: () => { CurvyWallToolManager.instance.apply(); }\n\t});\n\tgame.keybindings.register(SETTINGS.MOD_NAME, 'cancelTool', {\n\t\tname: 'df-curvy-walls.cancel',\n\t\teditable: [{ key: 'Delete' }],\n\t\tonDown: () => CurvyWallToolManager.instance.clearTool()\n\t});\n\tgame.keybindings.register(SETTINGS.MOD_NAME, 'incrementSegments', {\n\t\tname: 'df-curvy-walls.increment',\n\t\teditable: [{ key: 'Equal' }],\n\t\trepeat: true,\n\t\tonDown: () => { CurvyWallToolManager.instance.segments++; }\n\t});\n\tgame.keybindings.register(SETTINGS.MOD_NAME, 'decrementSegments', {\n\t\tname: 'df-curvy-walls.decrement',\n\t\teditable: [{ key: 'Minus' }],\n\t\trepeat: true,\n\t\tonDown: () => { CurvyWallToolManager.instance.segments--; }\n\t});\n});\n\nHooks.once(\"ready\", function () {\n\tif (!game.modules.get('lib-wrapper')?.active) {\n\t\tconsole.error('Missing libWrapper module dependency');\n\t\tif (game.user.isGM)\n\t\t\tui.notifications.error(game.i18n.localize('df-curvy-walls.errorLibWrapperMissing'));\n\t\treturn;\n\t}\n\t// @ts-ignore\n\tcanvas.walls.bezier = CurvyWallToolManager.instance;\n\tCurvyWallToolManager.instance.patchWallsLayer();\n});\n\nHooks.on('renderSceneControls', async (controls: SceneControls) => {\n\tif (!game.modules.get('lib-wrapper')?.active) return;\n\tif (!game.user.isGM) return;\n\tif (controls.activeControl !== 'walls') {\n\t\tawait curvyWallApp.close();\n\t\treturn;\n\t}\n\tcurvyWallApp.render(true);\n\tif (CurvyWallToolManager.instance.mode != Mode.None)\n\t\tCurvyWallToolManager.instance.render();\n});\n"],"names":["CurvyWallsToolBar","Application","constructor","options","super","_closing","_tools","beziercube","title","icon","isActive","CurvyWallToolManager","Mode","onClick","this","bezierquad","beziercirc","bezierrect","_generalControls","increment","decrement","apply","class","cancel","_placementControls","pointconstruct","toggleable","render","applyplacement","defaultOptions","mergeObject","popOut","template","getData","toolIsPlaced","ToolMode","toolControls","getTools","placementControls","name","push","tools","Object","keys","map","it","general","includes","controls","undefined","activateListeners","html","window","buttonOverflow","align","layersHeight","$","height","controlsHeight","layerCount","document","querySelector","childElementCount","controlCount","layers","Math","ceil","hiddenButtons","css","addEventListener","find","on","event","currentTarget","attr","tool","generalControl","placementControl","toolControl","close","PREF_PRESERVE","MODE_NAMES","None","Cube","Quad","Circ","Rect","WallPool","static","wallData","result","walls","pop","Wall","WallDocument","parent","canvas","scene","data","wall","_mode","currentHandler","_activeTool","_modeListener","_ignoreNextToolModeChange","_previousToolData","Map","l1","l2","c1","c2","c","a1","a2","t","r","b","l","_pointMapper","_inPointMapMode","graphicsContext","PIXI","Graphics","segments","value","clamped","mode","activeTool","currentlyMappingPoints","instance","_instance","clearTool","togglePointMapping","points","setModeListener","toolMode","listener","async","game","scenes","viewed","createEmbeddedDocuments","e","wallsLayer","preview","removeChildren","ui","notifications","info","i18n","localize","getTooltipMessage","permanent","active","forEach","x","remove","canApplyPointMapping","hasEnoughData","applyPointMapping","bindData","setMode","wrapped","self","checkPointForClick","origin","originalEvent","ctrlKey","startedWithCtrlHeld","PREF_DROP_KEY","altKey","placeTool","get","checkPointForDrag","start","destination","move","stop","clearContext","clear","addChild","drawHandles","pointData","getSegments","length","_getWallDataFromActiveTool","release","removeChild","duplicate","y","acquire","draw","refresh","destroy","visible","set","patchWallsLayer","MOD_NAME","libWrapper","register","_onClickLeft","_onDragLeftStart","_onDragLeftMove","_onDragLeftDrop","_onDragLeftCancel","_onClickRight","Hooks","BezierTool","NotPlaced","lastSegmentFetch","HANDLE_RADIUS","PREF_SMALL_HANDLES","TEXT_STYLE","TEXT_STYLE_BASE","fontSize","lineCenter","Point","lineA","lineB","_point","_event","_context","text","PreciseText","anchor","drawSegmentLabel","context","createText","position","drawBoundingBox","bounds","getRectangle","Rectangle","EMPTY","beginFill","lineStyle","LINE_SIZE","drawRoundedRect","left","top","width","endFill","drawHandle","fill","point","drawCircle","a","threshold","TextStyle","fontFamily","CONFIG","defaultFontFamily","stroke","strokeThickness","dropShadow","dropShadowColor","dropShadowBlur","max","round","dropShadowAngle","dropShadowDistance","padding","SETTINGS","moduleName","String","prototype","valueOf","key","config","settings","registerMenu","default","pointNearPoint","PI2","PI","InitializerIH","InitializerInputHandler","success","fail","CircleTool","arcHandle","RotatorHandle","sliceHandle","ellipseclose","closeLoopIfSliced","enabled","call","ellipsefinish","finishSliceIfShort","ellipseinc","snapSetIndex","ANGLE_SNAP_STEPS","ellipsedec","handles","Bounds","addPoint","polygon","Polygon","minX","minY","maxX","maxY","angle","center","getCenter","rect","halfWidth","halfHeight","createVector","theta","magnitude","cos","sin","count","deltaTheta","sliceAngle","rawAngle","initialPoints","middle","arc","getHandlePoint","slice","moveTo","lineTo","snapAngle","toDegrees","toFixed","arcLabel","parseFloat","copyFrom","PointInputHandler","PointRotationHandler","contains","PointArrayInputHandler","magnet","_angle","ax","ay","InputHandler","original","setAngle","to","vecX","vecY","atan","shouldSnap","whole","trunc","_origin","_tool","snap","_getWallEndpointCoordinates","_forceSnap","shiftKey","getWallEndPoint","min","abs","squaring","destPoint","squarePoint","origPoint","completion","_originalPoint","originalPoints","clone","_start","moveAll","delta","o","i","copyTo","MagnetPointInputHandler","masterPoint","slavePoint","originalPoint","offsetX","offsetY","RectangleTool","lastCount","topCount","rightCount","bottomCount","leftCount","buttonRadius","buttonOffset","incTop","createLineLabel","decTop","incRight","decRight","incBottom","decBottom","incLeft","decLeft","textTop","textRight","textBottom","textLeft","tint","rotation","STYLE","drawSegmentLabels","drawButtons","size","cubicTool","dx","dy","sqrt","barLength","controlA","controlB","CubicTool","bezier","Bezier","update","getLUT","lockHandles","cubiclock","acos","atan2","pow","crt","v","pi","tau","quart","nMax","Number","MAX_SAFE_INTEGER","nMin","MIN_SAFE_INTEGER","ZERO","z","utils","Tvalues","Cvalues","arcfn","derivativeFn","d","compute","_3d","order","mt","p","ret","mt2","t2","dCpts","JSON","parse","stringify","splice","computeWithRatios","ratios","f1","f2","f3","f4","derive","dpoints","list","dpt","j","between","m","M","approximately","precision","len","sum","ds","de","ts","te","lerp","v1","v2","pointToString","s","pointsToString","join","copy","obj","dx1","dy1","dx2","dy2","pos","indexOf","substring","dist","p1","p2","closest","LUT","mpos","mdist","idx","abcratio","n","bottom","projectionratio","lli8","x1","y1","x2","y2","x3","y3","x4","y4","lli4","p3","p4","lli","makeline","findbbox","sections","mx","my","MX","MY","bbox","mid","shapeintersections","s1","bbox1","s2","bbox2","curveIntersectionThreshold","bboxoverlap","intersections","startcap","forward","back","endcap","virtual","iss","intersects","makeshape","bpl","fpl","end","shape","getminmax","curve","concat","line","tx","ty","roots","aligned","reduce","m1","m2","filter","pa","pb","pc","q","q2","discriminant","u1","mp3","phi","t1","sd","droots","curvature","d1","d2","kOnly","num","dnm","adk","dk","k","dd","qdsum","pk","nk","inflections","v3","trm","sq","b1","b2","dims","dim","expandbox","_bbox","pairiteration","c1b","c2b","_t1","_t2","cc1","split","cc2","pairs","right","pair","results","getccenter","dx1p","dy1p","dx2p","dy2p","mx1","my1","mx2","my2","mx1n","my1n","mx2n","my2n","_","numberSort","PolyBezier","curves","toString","addCurve","offset","abs$1","cos$1","sin$1","acos$1","sqrt$1","pi$1","coords","args","Array","from","arguments","coordlen","newargs","higher","Error","step","dimlen","_linear","some","_lut","abc","getABC","A","S","B","E","C","selen","lx","ly","bx1","by1","bx2","by2","e1","e2","nc1","nc2","getUtils","toSVG","last","setRatios","verify","print","coordDigest","_print","computedirection","clockwise","derivative","bind","u","um","steps","error","lut","hits","project","ft","raise","np","pim","dderivative","normal","__normal3","__normal2","r1","r2","q1","R","hull","_p","pt","span","extrema","mfn","sort","values","overlaps","lbbox","tbbox","nv","scale","simple","n1","n2","segment","pass1","pass2","distanceFn","ov","rc","outline","d3","d4","reduced","fcurves","bcurves","alen","tlen","graduated","linearDistanceFunction","slen","reverse","fs","fe","bs","be","ls","le","outlineshapes","shapes","lineIntersects","curveintersects","selfintersects","arcs","errorThreshold","_iterate","_error","np1","ref","circles","safety","t_s","t_e","np2","np3","prev_arc","done","curr_good","prev_good","t_m","prev_e","interval","quadTool","cX","cY","nY","nX","control","QuadTool","PointMapper","lines","dimensions","_calculateCircle","drawEllipse","w","h","drawRect","utility","handle","findIndex","target","dimens","circle","generateCircle","pt1","pt2","pt3","isPerpendicular","radius","calcCircle","_count","_data","yDelta_a","xDelta_a","yDelta_b","xDelta_b","aSlope","bSlope","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","exports","module","__webpack_modules__","definition","defineProperty","enumerable","prop","hasOwnProperty","Symbol","toStringTag","curvyWallApp","once","scope","type","Boolean","hint","choices","alt","ctrl","keybindings","editable","onDown","repeat","modules","console","user","isGM","activeControl"],"sourceRoot":""}